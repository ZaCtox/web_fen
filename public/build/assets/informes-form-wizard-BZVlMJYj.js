let i=1;const l=3;document.addEventListener("DOMContentLoaded",function(){if(document.querySelector('.error, .invalid-feedback, [class*="error"]')){const o=document.querySelector("input.error, select.error, textarea.error");if(o){const s=o.closest(".hci-form-section");if(s){const c=s.getAttribute("data-step");c&&(i=parseInt(c))}}}m(i),f(),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(o=>{o.addEventListener("blur",function(){p(this)}),o.addEventListener("input",function(){u(this),d()})});const n=document.querySelector('select[name="tipo"]'),r=document.querySelector('select[name="magister_id"]');n&&n.addEventListener("change",d),r&&r.addEventListener("change",d)});window.nextStep=function(){v()&&i<l&&(i++,m(i),f())};window.prevStep=function(){i>1&&(i--,m(i),f())};window.navigateToStep=function(e){(e<=i||v())&&(i=e,m(i),f())};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/informes"):window.location.href=window.location.origin+"/informes"};function m(e){document.querySelectorAll(".hci-form-section").forEach(o=>{o.classList.remove("active")});const n=I(e),r=document.getElementById(n);r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),n==="resumen"&&d()}function f(){const e=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),n=document.getElementById("current-step"),r=i/l*100;e&&(e.style.height=r+"%"),t&&(t.textContent=Math.round(r)+"%"),n&&(n.textContent=`Paso ${i} de ${l}`);const o=document.getElementById("prev-btn"),s=document.getElementById("next-btn"),c=document.getElementById("submit-btn");o&&(o.style.display=i>1?"flex":"none"),s&&(s.style.display=i<l?"flex":"none"),c&&(c.style.display=i===l?"flex":"none")}function I(e){return["informacion","archivo","resumen"][e-1]}function v(){const e=I(i),t=document.getElementById(e);if(!t)return console.error("No se encontró la sección para el paso:",i,e),!1;const n=t.querySelectorAll("input[required], select[required], textarea[required]");let r=!0;return n.forEach(o=>{o.offsetParent!==null&&(o.type==="file"?o.hasAttribute("required")&&o.files.length===0?(p(o),r=!1):u(o):(o.value?o.value.trim():"")?u(o):(p(o),r=!1))}),r||B("Por favor, completa todos los campos requeridos antes de continuar."),r}function B(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function p(e){const t=e.checkValidity(),n=e.closest(".hci-field"),r=n==null?void 0:n.querySelector(".hci-field-error");if(t)u(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const o=document.createElement("div");o.className="hci-field-error",o.textContent=e.validationMessage||"Este campo es requerido",n==null||n.appendChild(o)}}function u(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),n=t==null?void 0:t.querySelector(".hci-field-error");n&&n.remove()}function d(){var S,x;const e=document.querySelector('input[name="nombre"]'),t=document.querySelector('select[name="tipo"]'),n=document.querySelector('input[name="archivo"]'),r=document.querySelector('select[name="magister_id"]'),o=(e==null?void 0:e.value)||"",s=((x=(S=n==null?void 0:n.files)==null?void 0:S[0])==null?void 0:x.name)||"";let c="No especificado";if(t&&t.value){const a=t.options[t.selectedIndex];c=(a==null?void 0:a.text)||t.value}let g="Todos los programas";if(r&&r.value){const a=r.options[r.selectedIndex];g=(a==null?void 0:a.text)||r.value}const h=document.getElementById("summary-nombre"),y=document.getElementById("summary-tipo"),w=document.getElementById("summary-archivo"),E=document.getElementById("summary-destinatario");h&&(h.textContent=o||"No especificado"),y&&(y.textContent=c),w&&(w.textContent=s||"Sin archivo seleccionado"),E&&(E.textContent=g)}window.submitForm=function(){if(v()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};function q(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function L(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over")}function C(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over");const t=e.dataTransfer.files;if(t.length>0){const n=document.getElementById("archivo-input");n.files=t,b({target:n})}}function b(e){const t=e.target.files[0];if(t){if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){alert("Por favor, selecciona un archivo PDF, DOC o DOCX."),e.target.value="";return}if(t.size>4*1024*1024){alert("El archivo no puede exceder los 4MB."),e.target.value="";return}document.getElementById("file-name").textContent=t.name,document.getElementById("file-preview").classList.remove("hidden"),document.getElementById("file-drop-text").textContent="Archivo seleccionado",d()}}function D(){document.getElementById("archivo-input").value="",document.getElementById("file-preview").classList.add("hidden"),document.getElementById("file-drop-text").textContent="Arrastra tu archivo aquí",d()}window.handleDragOver=q;window.handleDragLeave=L;window.handleFileDrop=C;window.handleFileSelect=b;window.clearFile=D;
