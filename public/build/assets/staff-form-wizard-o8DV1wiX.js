let n=1;const d=5;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const o=e.closest(".hci-form-section");o&&o.dataset.step&&(n=parseInt(o.dataset.step)||1)}l(n),u(n),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(o=>{o.addEventListener("blur",function(){B(this)}),o.addEventListener("input",function(){g(this),f()})}),f()});window.nextStep=function(){p()&&n<d&&(n++,l(n),u(n))};window.prevStep=function(){n>1&&(n--,l(n),u(n))};window.navigateToStep=function(e){(e<=n||p())&&(n=e,l(n),u(n))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/equipo"):window.location.href=window.location.origin+"/equipo"};function l(e){document.querySelectorAll(".hci-form-section").forEach(r=>{r.classList.remove("active")});const o=document.getElementById(m(e));o&&(o.classList.add("active"),o.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),m(e)==="resumen"&&f()}function u(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),c=e/d*100;t&&(t.style.height=c+"%"),o&&(o.textContent=Math.round(c)+"%"),r&&(r.textContent=`Paso ${e} de ${d}`);const i=document.getElementById("prev-btn"),s=document.getElementById("next-btn"),a=document.getElementById("submit-btn");i&&(i.style.display=e>1?"flex":"none"),s&&(s.style.display=e<d?"flex":"none"),a&&(a.style.display=e===d?"flex":"none")}function m(e){return["personal","foto","contacto","adicional","resumen"][e-1]}function p(){const t=document.getElementById(m(n)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(r=>{r.value.trim()?g(r):(B(r),o=!1)}),o||I("Por favor, completa todos los campos requeridos antes de continuar."),o}function I(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function B(e){const t=e.checkValidity(),o=e.closest(".hci-field"),r=o==null?void 0:o.querySelector(".hci-field-error");if(t)g(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const c=document.createElement("div");c.className="hci-field-error",c.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(c)}}function g(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function f(){var h,w,E,S,b;const e=((h=document.querySelector('input[name="nombre"]'))==null?void 0:h.value)||"",t=((w=document.querySelector('input[name="cargo"]'))==null?void 0:w.value)||"",o=((E=document.querySelector('input[name="email"]'))==null?void 0:E.value)||"",r=((S=document.querySelector('input[name="telefono"]'))==null?void 0:S.value)||"",c=((b=document.querySelector('input[name="anexo"]'))==null?void 0:b.value)||"No especificado",i=document.getElementById("resumen-nombre"),s=document.getElementById("resumen-cargo"),a=document.getElementById("resumen-email"),v=document.getElementById("resumen-telefono"),y=document.getElementById("resumen-anexo");i&&(i.textContent=e||"No especificado"),s&&(s.textContent=t||"No especificado"),a&&(a.textContent=o||"No especificado"),v&&(v.textContent=r||"No especificado"),y&&(y.textContent=c)}window.submitForm=function(){if(p()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};window.handleDragOver=function(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")};window.handleDragLeave=function(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over")};window.handleFotoDrop=function(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];x(o)}};window.handleFotoSelect=function(e){const t=e.target.files[0];t&&x(t)};function q(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>2*1024*1024?(alert("La imagen no puede exceder los 2MB."),!1):!0:(alert("Por favor, selecciona una imagen JPG, PNG o WEBP."),!1)}function x(e){if(q(e)){const t=new DataTransfer;t.items.add(e),document.getElementById("foto-input").files=t.files;const o=URL.createObjectURL(e);document.getElementById("foto-preview").src=o,document.getElementById("foto-name").textContent=e.name,document.getElementById("foto-preview-info").classList.remove("hidden"),document.getElementById("foto-drop-text").textContent="Foto seleccionada",showToast("Foto seleccionada correctamente","success")}}window.clearFoto=function(){document.getElementById("foto-input").value="",document.getElementById("foto-preview-info").classList.add("hidden"),document.getElementById("foto-drop-text").textContent="Arrastra tu foto aquí";const e="https://ui-avatars.com/api/?name=Foto&background=84b6f4&color=000000&size=300&bold=true&font-size=0.4";document.getElementById("foto-preview").src=e,currentFile=null};
