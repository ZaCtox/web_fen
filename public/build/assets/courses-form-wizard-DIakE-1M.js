let s=1;const I=3;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step-vertical"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step"),v(1),y(1);const e=window.PERIODS||[],t={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"},o=document.getElementById("anio"),r=document.getElementById("numero"),c=document.getElementById("period_id"),d=document.getElementById("magister_id"),m=document.getElementById("malla_curricular_id");let u=null;function f(){if(!d||!m)return;const i=d.value;m.querySelectorAll("option").forEach(n=>{if(n.value===""){n.style.display="block";return}n.getAttribute("data-magister")===i?n.style.display="block":(n.style.display="none",n.selected&&(m.value=""))})}d&&(d.addEventListener("change",()=>{f(),g()}),f());function p(){const i=o.value;if(r.innerHTML='<option value="">-- Selecciona un trimestre --</option>',!i)return;e.filter(n=>n.anio==i).map(n=>({numero:n.numero,id:n.id})).sort((n,a)=>n.numero-a.numero).forEach(n=>{const a=document.createElement("option");a.value=n.numero,a.textContent=`Trimestre ${t[n.numero]||n.numero}`,r.appendChild(a)}),u&&(r.value=u,u=null),window.actualizarPeriodId()}if(window.actualizarPeriodId=function(){const i=o.value,l=r.value,n=e.find(a=>a.anio==i&&a.numero==l);c.value=n?n.id:"",console.log("Actualizando period_id:",{anio:i,numero:l,periodId:c.value,periodo:n})},o&&r&&c){o.addEventListener("change",()=>{p(),g()}),r.addEventListener("change",()=>{window.actualizarPeriodId(),g()});const i=c.value;if(i){const l=e.find(n=>n.id==i);l&&(o.value=l.anio,u=l.numero,p())}}document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(i=>{i.addEventListener("blur",function(){T(this)}),i.addEventListener("input",function(){w(this),g()})})});window.nextStep=function(){E()&&s<I&&(s++,v(s),y(s))};window.prevStep=function(){s>1&&(s--,v(s),y(s))};window.navigateToStep=function(e){(e<=s||E())&&(s=e,v(s),y(s))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/courses"):window.location.href=window.location.origin+"/courses"};function v(e){const t=document.querySelectorAll(".hci-form-section"),o=document.querySelectorAll(".hci-progress-step-vertical");t.forEach(c=>{c.classList.remove("active")});const r=document.getElementById(P(e));r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),o.forEach((c,d)=>{d+1<=e?(c.classList.add("completed"),c.classList.add("active")):(c.classList.remove("completed"),c.classList.remove("active"))})}function y(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),c=e/I*100;t&&(t.style.height=c+"%"),o&&(o.textContent=Math.round(c)+"%"),r&&(r.textContent=`Paso ${e} de ${I}`)}function P(e){return["basica","programa","resumen"][e-1]}function E(){const t=document.getElementById(P(s)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(r=>{r.value.trim()?w(r):(T(r),o=!1)}),o||A("Por favor, completa todos los campos requeridos antes de continuar."),o}function A(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function T(e){const t=e.checkValidity(),o=e.closest(".hci-field"),r=o==null?void 0:o.querySelector(".hci-field-error");if(t)w(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const c=document.createElement("div");c.className="hci-field-error",c.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(c)}}function w(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function g(){var a,S,q,x,b,B,L,C;const e=((a=document.querySelector('input[name="nombre"]'))==null?void 0:a.value)||"";(S=document.querySelector('select[name="magister_id"]'))!=null&&S.value,(q=document.querySelector('select[name="anio"]'))!=null&&q.value,(x=document.querySelector('select[name="numero"]'))!=null&&x.value;const t=document.querySelector('select[name="magister_id"]'),o=document.querySelector('select[name="malla_curricular_id"]'),r=document.querySelector('select[name="anio"]'),c=document.querySelector('select[name="numero"]'),d=((b=t==null?void 0:t.selectedOptions[0])==null?void 0:b.text)||"No seleccionado",m=((B=o==null?void 0:o.selectedOptions[0])==null?void 0:B.text)||"Sin malla específica",u=((L=r==null?void 0:r.selectedOptions[0])==null?void 0:L.text)||"No seleccionado",f=((C=c==null?void 0:c.selectedOptions[0])==null?void 0:C.text)||"No seleccionado",p=document.getElementById("resumen-nombre"),h=document.getElementById("resumen-programa"),i=document.getElementById("resumen-malla"),l=document.getElementById("resumen-anio"),n=document.getElementById("resumen-trimestre");p&&(p.textContent=e||"No especificado"),h&&(h.textContent=d),i&&(i.textContent=m),l&&(l.textContent=u),n&&(n.textContent=f)}window.submitForm=function(){E()&&(typeof window.actualizarPeriodId=="function"&&window.actualizarPeriodId(),document.querySelector(".hci-form").submit())};
