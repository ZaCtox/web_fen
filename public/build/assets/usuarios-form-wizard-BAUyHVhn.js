let n=1,u=4;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step");const e=document.querySelector("form").action.includes("usuarios/");if(u=e?3:4,e){const t=document.querySelector('[data-step="3"]');if(t){t.style.opacity="0.5",t.style.pointerEvents="none",t.style.cursor="not-allowed";const r=t.querySelector(".hci-progress-step-content-vertical");if(r){const i=r.querySelector(".hci-progress-step-title");i&&(i.textContent="Sin cambios (Edición)");const s=r.querySelector(".hci-progress-step-desc");s&&(s.textContent="No aplica en edición")}}}c(1),d(1),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){S(this)}),t.addEventListener("input",function(){g(this),w()})})});window.nextStep=function(){f()&&n<u&&(n++,document.querySelector("form").action.includes("usuarios/")&&n===3&&(n=4),c(n),d(n))};window.prevStep=function(){n>1&&(n--,document.querySelector("form").action.includes("usuarios/")&&n===3&&(n=2),c(n),d(n))};window.navigateToStep=function(e){if(document.querySelector("form").action.includes("usuarios/")&&e===3){showStepNotification("En modo edición, el paso 3 no es necesario. Redirigiendo al resumen..."),setTimeout(()=>{navigateToStep(4)},1e3);return}(e<=n||f())&&(n=e,c(n),d(n))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/usuarios"):window.location.href=window.location.origin+"/usuarios"};function c(e){const o=document.querySelectorAll(".hci-form-section"),t=document.querySelectorAll(".hci-progress-step-vertical");if(document.querySelector("form").action.includes("usuarios/")&&e===3){c(4),showStepNotification("Este paso no es necesario en modo edición. Se ha redirigido al resumen.");return}o.forEach(s=>{s.classList.remove("active")});const i=document.getElementById(m(e));i?(i.classList.add("active"),i.scrollIntoView({behavior:"smooth",block:"start"})):console.warn(`No se encontró la sección para el paso ${e}: ${m(e)}`),t.forEach((s,a)=>{a+1<=e?(s.classList.add("completed"),s.classList.add("active")):(s.classList.remove("completed"),s.classList.remove("active"))})}function d(e){const o=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),i=e/u*100;o&&(o.style.height=i+"%"),t&&(t.textContent=Math.round(i)+"%"),r&&(r.textContent=`Paso ${e} de ${u}`)}function m(e){return document.querySelector("form").action.includes("usuarios/")?["personal","contacto","resumen"][e-1]:["personal","contacto","adicional","resumen"][e-1]}function f(){const e=document.getElementById(m(n));if(!e)return!0;const o=e.querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return o.forEach(r=>{r.value.trim()?g(r):(S(r),t=!1)}),t||v("Por favor, completa todos los campos requeridos antes de continuar."),t}function v(e){let o=document.getElementById("step-error-message");o||(o=document.createElement("div"),o.id="step-error-message",o.className="hci-error-message",document.querySelector(".hci-container").insertBefore(o,document.querySelector(".hci-wizard-layout"))),o.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{o&&o.remove()},5e3)}function S(e){const o=e.checkValidity(),t=e.closest(".hci-field"),r=t==null?void 0:t.querySelector(".hci-field-error");if(o)g(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const i=document.createElement("div");i.className="hci-field-error",i.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(i)}}function g(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const o=e.closest(".hci-field"),t=o==null?void 0:o.querySelector(".hci-field-error");t&&t.remove()}function w(){var y,h,E;const e=((y=document.querySelector('input[name="name"]'))==null?void 0:y.value)||"",o=((h=document.querySelector('input[name="email"]'))==null?void 0:h.value)||"",t=((E=document.querySelector('select[name="rol"]'))==null?void 0:E.value)||"",r=document.querySelector("form").action.includes("usuarios/"),i=document.getElementById("summary-name"),s=document.getElementById("summary-email"),a=document.getElementById("summary-rol"),l=document.getElementById("summary-password");i&&(i.textContent=e||"No especificado"),s&&(s.textContent=o||"No especificado"),a&&(a.textContent=t||"No especificado"),l&&(r?l.textContent="No se modifica":l.textContent="Se generará automáticamente");const p=document.getElementById("email-notification");p&&(p.textContent=o||"el correo especificado")}window.submitForm=function(){f()&&document.querySelector(".hci-form").submit()};
