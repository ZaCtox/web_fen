let d=1;const p=3;let o=0;window.addEntryToContainer=function(e=null){o++;const r=document.getElementById("entradas-container"),t=(e==null?void 0:e.location_type)||"",s=(e==null?void 0:e.room_id)||"",m=(e==null?void 0:e.location_detail)||"",g=(e==null?void 0:e.observation)||"",i=(e==null?void 0:e.photo_url)||"",n=(e==null?void 0:e.hora)||"",a=(e==null?void 0:e.escala)||"",C=(e==null?void 0:e.programa)||"",L=(e==null?void 0:e.area)||"",q=(e==null?void 0:e.tarea)||"";let w='<option value="">Seleccione una sala específica</option>';window.dailyReportsData&&window.dailyReportsData.rooms&&window.dailyReportsData.rooms.forEach(f=>{const b=f.id==s?"selected":"";w+='<option value="'+f.id+'" '+b+">"+f.name+"</option>"});let k='<option value="">Seleccione un programa</option>';window.dailyReportsData&&window.dailyReportsData.magisters&&window.dailyReportsData.magisters.forEach(f=>{const b=f.nombre==C?"selected":"";k+='<option value="'+f.nombre+'" '+b+">"+f.nombre+"</option>"});const I='<div class="entrada-item border border-gray-200 dark:border-gray-600 rounded-lg p-4 mb-4 bg-gray-50 dark:bg-gray-700" data-index="'+o+'"><div class="flex justify-between items-center mb-4"><h4 class="text-md font-medium text-gray-900 dark:text-gray-100">Observación #'+o+`</h4><button type="button" onclick="this.closest('.entrada-item').remove()" class="hci-button hci-lift hci-focus-ring p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-200" title="Eliminar observación"><img src="/icons/trashw.svg" alt="Eliminar" class="w-4 h-4"></button></div><div class="mb-6 p-4 bg-gradient-to-r from-teal-50 to-red-50 dark:from-gray-800 dark:to-gray-700 rounded-lg border border-gray-200 dark:border-gray-600" onclick="clearSeveritySelection(`+o+')" style="cursor: pointer;"><h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Indicador de Severidad <span class="text-red-500">*</span></h5>'+(a?"":'<div class="severity-error-message text-sm text-red-500 mb-3 font-medium">⚠️ Debe seleccionar un nivel de severidad</div>')+'<div class="flex justify-center mb-3"><div class="flex w-full justify-between px-4"><div class="flex-1 flex justify-center"><img src="/icons/normal.svg" class="w-8 h-8" alt="Normal"></div><div class="flex-1 flex justify-center"><img src="/icons/leve.svg" class="w-8 h-8" alt="Leve"></div><div class="flex-1 flex justify-center"><img src="/icons/moderado.svg" class="w-8 h-8" alt="Moderado"></div><div class="flex-1 flex justify-center"><img src="/icons/fuerte.svg" class="w-8 h-8" alt="Fuerte"></div><div class="flex-1 flex justify-center"><img src="/icons/critico.svg" class="w-8 h-8" alt="Crítico"></div></div></div><div class="flex items-center justify-center mb-3"><div class="flex w-full bg-white dark:bg-gray-600 p-2 rounded-lg shadow-inner">'+Array.from({length:10},(f,b)=>{const l=b+1;let c="",u="";return l===1?(c="#4DBCC6",u="Normal"):l===2?(c="#3C9EAA",u="Normal"):l===3?(c="#8B8232",u="Leve"):l===4?(c="#B4A53C",u="Leve"):l===5?(c="#FFCC00",u="Moderado"):l===6?(c="#FF9900",u="Moderado"):l===7?(c="#FF6600",u="Fuerte"):l===8?(c="#FF3300",u="Fuerte"):l===9?(c="#FF0000",u="Crítico"):(c="#CC0000",u="Crítico"),'<div class="flex-1 h-12 rounded-sm '+(a==l?"ring-2 ring-blue-500 shadow-lg":"")+' flex items-center justify-center text-lg font-bold text-white cursor-pointer hover:scale-105 transition-all duration-200" style="background-color: '+c+';" onclick="event.stopPropagation(); selectSeverity('+o+", "+l+')" title="'+l+" - "+u+'">'+l+"</div>"}).join("")+'</div></div><div class="flex justify-between text-sm font-medium text-gray-700 dark:text-gray-300 px-2"><span>Normal</span><span>Leve</span><span>Moderado</span><span>Fuerte</span><span>Crítico</span></div>'+(a?'<div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900 rounded-lg border border-blue-200 dark:border-blue-700"><div class="flex items-center justify-center gap-3"><div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-lg" style="background-color: '+(a===1?"#4DBCC6":a===2?"#3C9EAA":a===3?"#8B8232":a===4?"#B4A53C":a===5?"#FFCC00":a===6?"#FF9900":a===7?"#FF6600":a===8?"#FF3300":a===9?"#FF0000":"#CC0000")+';">'+a+'</div><div class="text-center"><div class="text-sm font-semibold text-blue-700 dark:text-blue-300">Seleccionado: '+a+'</div><div class="text-xs text-blue-600 dark:text-blue-400">'+(a<=2?"Normal":a<=4?"Leve":a<=6?"Moderado":a<=8?"Fuerte":"Crítico")+'</div></div><button type="button" onclick="clearSeveritySelection('+o+')" class="text-red-500 hover:text-red-700 text-sm font-medium">✕ Limpiar</button></div></div>':"")+'<input type="hidden" name="entries['+o+'][escala]" id="escala-'+o+'" value="'+a+'"></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horario <span class="text-red-500">*</span></label><input type="text" name="entries['+o+'][hora]" value="'+n+'" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Ej: 08:30 – 08:50" required></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Programa (Magister) <span class="text-red-500">*</span></label><select name="entries['+o+'][programa]" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" required>'+k+'</select></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Área <span class="text-red-500">*</span></label><input type="text" name="entries['+o+'][area]" value="'+L+'" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Ej: TERRENO" required></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Ubicación <span class="text-red-500">*</span></label><select name="entries['+o+'][location_type]" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" onchange="toggleLocationFields'+o+'(this)" required><option value="">Seleccione el tipo de ubicación</option><option value="Sala"'+(t==="Sala"?" selected":"")+'>Sala de Clases</option><option value="Baño"'+(t==="Baño"?" selected":"")+'>Baño</option><option value="Pasillo"'+(t==="Pasillo"?" selected":"")+'>Pasillo</option><option value="Laboratorio"'+(t==="Laboratorio"?" selected":"")+'>Laboratorio</option><option value="Oficina"'+(t==="Oficina"?" selected":"")+'>Oficina</option><option value="Otro"'+(t==="Otro"?" selected":"")+'>Otro</option></select></div><div id="sala-field-'+o+'" class="'+(t==="Sala"?"":"hidden")+'"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Seleccionar Sala</label><select name="entries['+o+'][room_id]" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200">'+w+'</select></div><div id="detalle-field-'+o+'" class="'+(["Baño","Pasillo","Laboratorio","Oficina","Otro"].includes(t)?"":"hidden")+'"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Detalle de Ubicación</label><input type="text" name="entries['+o+'][location_detail]" value="'+m+'" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Ej: Baño primer piso, Pasillo edificio A"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observación <span class="text-red-500">*</span></label><textarea name="entries['+o+'][observation]" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Describe lo observado (mínimo 5 caracteres)..." required>'+g+'</textarea></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tarea (Opcional)</label><textarea name="entries['+o+'][tarea]" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Tarea relacionada...">'+q+"</textarea></div></div>"+(i?'<div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Imagen Actual</label><img src="'+i+'" alt="Imagen actual" class="max-w-xs h-auto rounded-lg shadow-md"></div>':"")+'<div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">'+(i?"Reemplazar Imagen (Opcional)":"Evidencia Fotográfica (Opcional)")+'</label><div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg hover:border-[#4d82bc] transition-colors duration-200"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-gray-600 dark:text-gray-400"><label for="photo-'+o+'" class="relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-[#4d82bc] hover:text-[#005187] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[#4d82bc]"><span>Subir una foto</span><input id="photo-'+o+'" name="entries['+o+'][photo]" type="file" accept="image/*" class="sr-only" onchange="previewImage'+o+'(this)"></label><p class="pl-1">o arrastra y suelta</p></div><p class="text-xs text-gray-500 dark:text-gray-400">PNG, JPG, GIF hasta 10MB</p></div></div><div id="image-preview-'+o+'" class="mt-4 text-center hidden"><img id="preview-img-'+o+'" src="" alt="Preview" class="mx-auto h-32 w-32 object-cover rounded-lg shadow"><p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Vista previa</p></div></div></div>';r.insertAdjacentHTML("beforeend",I),window["toggleLocationFields"+o]=function(f){const b=o,l=f.value,c=document.getElementById("sala-field-"+b),u=document.getElementById("detalle-field-"+b);c.classList.add("hidden"),u.classList.add("hidden"),l==="Sala"?c.classList.remove("hidden"):["Baño","Pasillo","Laboratorio","Oficina","Otro"].includes(l)&&u.classList.remove("hidden")},window["previewImage"+o]=function(f){const b=f.files[0];if(b){const l=new FileReader;l.onload=function(c){const u=document.getElementById("image-preview-"+o),S=document.getElementById("preview-img-"+o);S.src=c.target.result,u.classList.remove("hidden")},l.readAsDataURL(b)}}};window.selectSeverity=function(e,r){const t=document.getElementById("escala-"+e);if(t){t.value=r;const s=document.querySelector(`[data-index="${e}"]`);if(s){s.querySelectorAll('[onclick*="selectSeverity"]').forEach(n=>{n.classList.remove("ring-2","ring-blue-500")});const g=s.querySelector(`[onclick="selectSeverity(${e}, ${r})"]`);g&&g.classList.add("ring-2","ring-blue-500");const i=s.querySelector(".severity-error-message");i&&(i.style.display="none"),j(e,r)}}};function j(e,r){const t=document.querySelector(`[data-index="${e}"]`);if(!t)return;const s=t.querySelector('[onclick*="clearSeveritySelection"]');if(!s)return;const m=s.querySelector(".severity-selection-indicator");m&&m.remove();const g=document.createElement("div");g.className="severity-selection-indicator mt-4 p-3 bg-blue-50 dark:bg-blue-900 rounded-lg border border-blue-200 dark:border-blue-700";let i="",n="";r===1?(i="#4DBCC6",n="Normal"):r===2?(i="#3C9EAA",n="Normal"):r===3?(i="#8B8232",n="Leve"):r===4?(i="#B4A53C",n="Leve"):r===5?(i="#FFCC00",n="Moderado"):r===6?(i="#FF9900",n="Moderado"):r===7?(i="#FF6600",n="Fuerte"):r===8?(i="#FF3300",n="Fuerte"):r===9?(i="#FF0000",n="Crítico"):(i="#CC0000",n="Crítico"),g.innerHTML=`
        <div class="flex items-center justify-center gap-3">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-lg" style="background-color: ${i};">${r}</div>
            <div class="text-center">
                <div class="text-sm font-semibold text-blue-700 dark:text-blue-300">Seleccionado: ${r}</div>
                <div class="text-xs text-blue-600 dark:text-blue-400">${n}</div>
            </div>
            <button type="button" onclick="clearSeveritySelection(${e})" class="text-red-500 hover:text-red-700 text-sm font-medium">✕ Limpiar</button>
        </div>
    `,s.appendChild(g)}window.clearSeveritySelection=function(e){const r=document.getElementById("escala-"+e);if(r){r.value="";const t=document.querySelector(`[data-index="${e}"]`);if(t){t.querySelectorAll('[onclick*="selectSeverity"]').forEach(i=>{i.classList.remove("ring-2","ring-blue-500")});const m=t.querySelector(".severity-selection-indicator");m&&m.remove();const g=t.querySelector(".severity-error-message");if(g)g.style.display="block";else{const i=t.querySelector('[onclick*="clearSeveritySelection"]');if(i&&!i.querySelector(".severity-error-message")){const a=document.createElement("div");a.className="severity-error-message text-sm text-red-500 mb-3 font-medium",a.innerHTML="⚠️ Debe seleccionar un nivel de severidad",i.insertBefore(a,i.children[1])}}}}};document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const t=e.closest(".hci-form-section");t&&t.dataset.step&&(d=parseInt(t.dataset.step)||1)}v(d),x(d),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){B(this)}),t.addEventListener("input",function(){h(this)})})});window.nextStep=function(){y()&&d<p&&(d++,v(d),x(d))};window.prevStep=function(){d>1&&(d--,v(d),x(d))};window.navigateToStep=function(e){(e<=d||y())&&(d=e,v(d),x(d))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/daily-reports"):window.location.href=window.location.origin+"/daily-reports"};function v(e){document.querySelectorAll(".hci-form-section").forEach(s=>{s.classList.remove("active")});const t=document.getElementById(F(e));t&&(t.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function x(e){const r=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),s=document.getElementById("current-step"),m=e/p*100;r&&(r.style.height=m+"%"),t&&(t.textContent=Math.round(m)+"%"),s&&(s.textContent=`Paso ${e} de ${p}`);const g=document.getElementById("prev-btn"),i=document.getElementById("next-btn"),n=document.getElementById("submit-btn");g&&(g.style.display=e>1?"flex":"none"),i&&(i.style.display=e<p?"flex":"none"),n&&(n.style.display=e===p?"flex":"none")}function F(e){return["informacion","observaciones","resumen"][e-1]}function y(){const e=document.getElementById(F(d));if(!e||d===3)return!0;const r=e.querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return r.forEach(s=>{s.value.trim()?h(s):(B(s),t=!1)}),d===2&&document.querySelectorAll(".entrada-item").length===0&&(E("Debe agregar al menos una observación."),t=!1),t||E("Por favor, completa todos los campos requeridos antes de continuar."),t}function E(e){let r=document.getElementById("step-error-message");if(!r){r=document.createElement("div"),r.id="step-error-message",r.className="hci-error-message";const t=document.querySelector(".hci-container");t&&t.insertBefore(r,document.querySelector(".hci-wizard-layout"))}r.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{r&&r.remove()},5e3)}function B(e){const r=e.checkValidity(),t=e.closest(".hci-field"),s=t==null?void 0:t.querySelector(".hci-field-error");if(r)h(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!s){const m=document.createElement("div");m.className="hci-field-error",m.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(m)}}function h(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const r=e.closest(".hci-field"),t=r==null?void 0:r.querySelector(".hci-field-error");t&&t.remove()}window.submitForm=function(){if(console.log("submitForm called"),y()){console.log("Validation passed, submitting form");const e=document.querySelector(".hci-form");console.log("Form found:",e),e.submit()}else console.log("Validation failed")};document.addEventListener("DOMContentLoaded",function(){window.dailyReportsData&&window.dailyReportsData.entries&&(window.dailyReportsData.entries.length===0?window.addEntryToContainer():window.dailyReportsData.entries.forEach(e=>{window.addEntryToContainer(e)}))});
