let c=1;const l=4;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const s=e.closest(".hci-form-section");s&&s.dataset.step&&(c=parseInt(s.dataset.step)||1)}p(c),g(c),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(s=>{s.addEventListener("blur",function(){k(this)}),s.addEventListener("input",function(){y(this),v()})});const o=document.querySelector('input[name="titulo"]'),r=document.querySelector('textarea[name="contenido"]'),n=document.querySelector('input[name="icono"]'),i=document.querySelector('select[name="color"]');o&&o.addEventListener("input",m),r&&r.addEventListener("input",m),n&&n.addEventListener("input",m),i&&i.addEventListener("change",m),v()});window.nextStep=function(){f()&&c<l&&(c++,p(c),g(c))};window.prevStep=function(){c>1&&(c--,p(c),g(c))};window.navigateToStep=function(e){(e<=c||f())&&(c=e,p(c),g(c))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/novedades"):window.location.href=window.location.origin+"/novedades"};function p(e){document.querySelectorAll(".hci-form-section").forEach(n=>{n.classList.remove("active")});const o=N(e),r=document.getElementById(o);r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),o==="resumen"&&v()}function g(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),n=e/l*100;t&&(t.style.height=n+"%"),o&&(o.textContent=Math.round(n)+"%"),r&&(r.textContent=`Paso ${e} de ${l}`);const i=document.getElementById("prev-btn"),s=document.getElementById("next-btn"),d=document.getElementById("submit-btn");i&&(i.style.display=e>1?"flex":"none"),s&&(s.style.display=e<l?"flex":"none"),d&&(d.style.display=e===l?"flex":"none")}function N(e){return["basica","configuracion","diseno","resumen"][e-1]}function f(){console.log(`üîç validateCurrentStep() - Paso ${c}`);const e=N(c);console.log(`üìã ID de secci√≥n: ${e}`);const t=document.getElementById(e);console.log("üìÑ Secci√≥n encontrada:",t);const o=t==null?void 0:t.querySelectorAll("input[required], select[required], textarea[required]");console.log("üìù Campos requeridos encontrados:",(o==null?void 0:o.length)||0);let r=!0;return o&&o.forEach((n,i)=>{console.log(`üîç Campo ${i+1}:`,n.name,"=",n.value),n.value.trim()?(console.log(`‚úÖ Campo ${n.name} tiene valor`),y(n)):(console.log(`‚ùå Campo ${n.name} est√° vac√≠o`),k(n),r=!1)}),console.log(`üéØ Paso ${c} es v√°lido:`,r),r||(console.log("‚ùå Mostrando error de validaci√≥n"),U("Por favor, completa todos los campos requeridos antes de continuar.")),r}function U(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function k(e){const t=e.checkValidity(),o=e.closest(".hci-field"),r=o==null?void 0:o.querySelector(".hci-field-error");if(t)y(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const n=document.createElement("div");n.className="hci-field-error",n.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(n)}}function y(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function v(){var I,q,B,C,L,$,P,T,M;const e=((I=document.querySelector('input[name="titulo"]'))==null?void 0:I.value)||"",t=((q=document.querySelector('textarea[name="contenido"]'))==null?void 0:q.value)||"",o=((B=document.querySelector('select[name="tipo_novedad"]'))==null?void 0:B.value)||"",r=((C=document.querySelector('input[name="es_urgente"]'))==null?void 0:C.checked)||!1,n=((L=document.querySelector('input[name="visible_publico"]'))==null?void 0:L.checked)||!1,i=(($=document.querySelector('input[name="icono"]'))==null?void 0:$.value)||"üì∞",s=((P=document.querySelector('select[name="color"]'))==null?void 0:P.value)||"blue",d=((M=(T=document.querySelector('select[name="magister_id"]'))==null?void 0:T.selectedOptions[0])==null?void 0:M.text)||"No especificado",a=document.getElementById("resumen-titulo"),u=document.getElementById("resumen-contenido"),h=document.getElementById("resumen-tipo"),b=document.getElementById("resumen-urgente"),S=document.getElementById("resumen-visibilidad"),w=document.getElementById("resumen-icono"),x=document.getElementById("resumen-color"),E=document.getElementById("resumen-programa");a&&(a.textContent=e||"No especificado"),u&&(u.textContent=t||"No especificado"),h&&(h.textContent=o||"No especificado"),b&&(b.textContent=r?"S√≠":"No"),S&&(S.textContent=n?"P√∫blico":"Privado"),w&&(w.textContent=i),x&&(x.textContent=s),E&&(E.textContent=d)}function m(){var i,s,d,a;const e=((i=document.querySelector('input[name="titulo"]'))==null?void 0:i.value)||"T√≠tulo de la novedad",t=((s=document.querySelector('textarea[name="contenido"]'))==null?void 0:s.value)||"Contenido de la novedad...",o=((d=document.querySelector('input[name="icono"]'))==null?void 0:d.value)||"üì∞",r=((a=document.querySelector('select[name="color"]'))==null?void 0:a.value)||"blue",n=document.getElementById("novedad-preview");if(n){const u={blue:"bg-blue-500",green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500",purple:"bg-purple-500",indigo:"bg-indigo-500"};n.innerHTML=`
            <div class="bg-white border rounded-lg p-4 shadow-md">
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-3">${o}</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-900">${e}</h3>
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${u[r]} text-white">
                            ${r}
                        </span>
                    </div>
                </div>
                <p class="text-sm text-gray-600">${t.substring(0,150)}${t.length>150?"...":""}</p>
            </div>
        `}}window.submitForm=function(){if(f()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
