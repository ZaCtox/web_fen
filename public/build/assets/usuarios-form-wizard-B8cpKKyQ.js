let i=1,s=3;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const o=e.closest(".hci-form-section");o&&o.dataset.step&&(i=parseInt(o.dataset.step)||1)}const t=document.getElementById("is-editing"),n=t&&t.value==="1";if(s=n?2:3,n){const o=document.querySelector('.hci-progress-sidebar [data-step="3"]');o&&(o.style.display="none")}u(i),m(i),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(o=>{o.addEventListener("blur",function(){w(this)}),o.addEventListener("input",function(){p(this),S()})})});window.nextStep=function(){g()&&i<s&&(i++,u(i),m(i))};window.prevStep=function(){i>1&&(i--,u(i),m(i))};window.navigateToStep=function(e){const t=document.getElementById("is-editing");t&&t.value==="1"&&e>2||e>s||(e<=i||g())&&(i=e,u(i),m(i))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/usuarios"):window.location.href=window.location.origin+"/usuarios"};function u(e){document.querySelectorAll(".hci-form-section").forEach(r=>{r.classList.remove("active")});const n=document.getElementById(l(e));n?(n.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"start"})):console.warn(`No se encontró la sección para el paso ${e}: ${l(e)}`),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),l(e)==="resumen"&&S()}function m(e){const t=document.getElementById("progress-bar"),n=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),o=e/s*100;t&&(t.style.height=o+"%"),n&&(n.textContent=Math.round(o)+"%"),r&&(r.textContent=`Paso ${e} de ${s}`);const c=document.getElementById("prev-btn"),a=document.getElementById("next-btn"),d=document.getElementById("submit-btn");c&&(c.style.display=e>1?"flex":"none"),a&&(a.style.display=e<s?"flex":"none"),d&&(d.style.display=e===s?"flex":"none")}function l(e){const t=document.getElementById("is-editing");return t&&t.value==="1"?["personal","resumen"][e-1]||"resumen":["personal","notificacion","resumen"][e-1]||"resumen"}function g(){const e=document.getElementById(l(i));if(!e)return!0;const t=e.querySelectorAll("input[required], select[required], textarea[required]");let n=!0;return t.forEach(r=>{r.value.trim()?p(r):(w(r),n=!1)}),n||I("Por favor, completa todos los campos requeridos antes de continuar."),n}function I(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function w(e){const t=e.checkValidity(),n=e.closest(".hci-field"),r=n==null?void 0:n.querySelector(".hci-field-error");if(t)p(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const o=document.createElement("div");o.className="hci-field-error",o.textContent=e.validationMessage||"Este campo es requerido",n==null||n.appendChild(o)}}function p(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),n=t==null?void 0:t.querySelector(".hci-field-error");n&&n.remove()}function S(){var v,E,h;const e=((v=document.querySelector('input[name="name"]'))==null?void 0:v.value)||"",t=((E=document.querySelector('input[name="email"]'))==null?void 0:E.value)||"",n=((h=document.querySelector('select[name="rol"]'))==null?void 0:h.value)||"",r=document.getElementById("is-editing"),o=r&&r.value==="1",c=document.getElementById("summary-name"),a=document.getElementById("summary-email"),d=document.getElementById("summary-rol"),f=document.getElementById("summary-password");c&&(c.textContent=e||"No especificado"),a&&(a.textContent=t||"No especificado"),d&&(d.textContent=n||"No especificado"),f&&(o?f.textContent="No se modifica":f.textContent="Se generará automáticamente");const y=document.getElementById("email-notification");y&&(y.textContent=t||"el correo especificado")}window.submitForm=function(){if(g()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
