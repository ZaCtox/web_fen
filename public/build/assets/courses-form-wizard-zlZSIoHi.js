let u=1;const y=3;function v(e){const t=document.querySelectorAll(".hci-form-section");document.querySelectorAll(".hci-progress-step-vertical"),t.forEach(s=>{s.classList.remove("active")});const o=document.getElementById(C(e));o&&(o.classList.add("active"),o.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function h(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),s=document.getElementById("current-step"),i=e/y*100;t&&(t.style.height=i+"%"),o&&(o.textContent=Math.round(i)+"%"),s&&(s.textContent=`Paso ${e} de ${y}`)}function C(e){return["basica","programa","resumen"][e-1]}function b(){const t=document.getElementById(C(u)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(s=>{s.value.trim()?q(s):(P(s),o=!1)}),o||H("Por favor, completa todos los campos requeridos antes de continuar."),o}function H(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function P(e){const t=e.checkValidity(),o=e.closest(".hci-field"),s=o==null?void 0:o.querySelector(".hci-field-error");if(t)q(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!s){const i=document.createElement("div");i.className="hci-field-error",i.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(i)}}function q(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function g(){var E,I,S,x,w,L,B,A;const e=((E=document.querySelector('input[name="nombre"]'))==null?void 0:E.value)||"",t=((I=document.querySelector('input[name="sct"]'))==null?void 0:I.value)||"";document.querySelector('select[name="requisitos[]"]'),(S=document.querySelector('select[name="magister_id"]'))!=null&&S.value,(x=document.querySelector('select[name="anio"]'))!=null&&x.value,(w=document.querySelector('select[name="numero"]'))!=null&&w.value;const o=document.querySelector('select[name="magister_id"]'),s=document.querySelector('select[name="anio"]'),i=document.querySelector('select[name="numero"]'),m=((L=o==null?void 0:o.selectedOptions[0])==null?void 0:L.text)||"No seleccionado",f=((B=s==null?void 0:s.selectedOptions[0])==null?void 0:B.text)||"No seleccionado",p=((A=i==null?void 0:i.selectedOptions[0])==null?void 0:A.text)||"No seleccionado",r=document.getElementById("resumen-nombre"),a=document.getElementById("resumen-sct"),n=document.getElementById("resumen-requisitos"),d=document.getElementById("resumen-programa"),c=document.getElementById("resumen-anio"),l=document.getElementById("resumen-trimestre");if(r&&(r.textContent=e||"No especificado"),a&&(t?a.innerHTML=`${t} cr√©ditos`:a.innerHTML='<span class="text-gray-400">No especificado</span>'),n){const k=document.querySelectorAll(".requisito-chip");k.length>0?n.innerHTML=Array.from(k).map(T=>{const M=T.getAttribute("data-value"),N=T.textContent.trim();return M==="ingreso"?'<span class="inline-flex items-center px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 text-sm font-medium rounded-full">üéì Ingreso</span>':`<span class="inline-flex items-center px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-sm font-medium rounded-full">${N}</span>`}).join(""):n.innerHTML='<span class="text-gray-400">No especificado</span>'}d&&(d.textContent=m),c&&(c.textContent=f),l&&(l.textContent=p)}function z(){const e=document.getElementById("requisitos-search"),t=document.getElementById("requisitos-dropdown"),o=document.getElementById("requisitos-selected"),s=document.getElementById("requisitos-hidden");if(!e||!t||!o)return;let i=[];document.querySelectorAll(".requisito-chip").forEach(r=>{const a=r.getAttribute("data-value");a&&i.push(a)});function m(){s.value=i.join(",")}function f(r,a){if(i.includes(r))return;i.push(r),m();const n=document.createElement("span");n.className="requisito-chip inline-flex items-center gap-1 px-3 py-1 text-sm font-medium rounded-full",n.setAttribute("data-value",r),r==="ingreso"?(n.className+=" bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200",n.innerHTML='üéì Ingreso <button type="button" class="requisito-remove hover:text-green-600 dark:hover:text-green-400" data-value="ingreso">√ó</button>'):(n.className+=" bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200",n.innerHTML=`${a} <button type="button" class="requisito-remove hover:text-blue-600 dark:hover:text-blue-400" data-value="${r}">√ó</button>`),o.appendChild(n),n.querySelector(".requisito-remove").addEventListener("click",()=>p(r)),g()}function p(r){i=i.filter(n=>n!==r),m();const a=o.querySelector(`[data-value="${r}"]`);a&&a.remove(),g()}e.addEventListener("input",function(){const r=this.value.toLowerCase(),a=t.querySelectorAll(".requisito-option");let n=!1;a.forEach(d=>{const c=d.getAttribute("data-text").toLowerCase(),l=d.getAttribute("data-value");c.includes(r)&&!i.includes(l)?(d.style.display="block",n=!0):d.style.display="none"}),t.classList.toggle("hidden",!n||r==="")}),t.addEventListener("click",function(r){const a=r.target.closest(".requisito-option");if(!a)return;const n=a.getAttribute("data-value"),d=a.getAttribute("data-text");f(n,d),e.value="",t.classList.add("hidden")}),o.addEventListener("click",function(r){if(r.target.classList.contains("requisito-remove")){const a=r.target.getAttribute("data-value");p(a)}}),document.addEventListener("click",function(r){!e.contains(r.target)&&!t.contains(r.target)&&t.classList.add("hidden")}),e.addEventListener("focus",function(){this.value===""&&t.classList.remove("hidden")}),m()}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step-vertical"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step");const e=document.querySelector(".hci-form-section .hci-field-error, .hci-form-section .text-red-600, .hci-form-section .border-red-500");if(e){const n=e.closest(".hci-form-section");n&&n.dataset.step&&(u=parseInt(n.dataset.step)||1)}v(u),h(u);const t=window.PERIODS||[],o={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"},s=document.getElementById("anio"),i=document.getElementById("numero"),m=document.getElementById("period_id"),f=document.getElementById("magister_id");let p=null;f&&f.addEventListener("change",()=>{g()});function r(){const n=s.value;if(i.innerHTML='<option value="">-- Selecciona un trimestre --</option>',!n)return;t.filter(c=>c.anio==n).map(c=>({numero:c.numero,id:c.id})).sort((c,l)=>c.numero-l.numero).forEach(c=>{const l=document.createElement("option");l.value=c.numero,l.textContent=`Trimestre ${o[c.numero]||c.numero}`,i.appendChild(l)}),p&&(i.value=p,p=null),window.actualizarPeriodId()}if(window.actualizarPeriodId=function(){const n=s.value,d=i.value,c=t.find(l=>l.anio==n&&l.numero==d);m.value=c?c.id:"",console.log("Actualizando period_id:",{anio:n,numero:d,periodId:m.value,periodo:c})},s&&i&&m){s.addEventListener("change",()=>{r(),g()}),i.addEventListener("change",()=>{window.actualizarPeriodId(),g()});const n=m.value;if(n){const d=t.find(c=>c.id==n);d&&(s.value=d.anio,p=d.numero,r())}}document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(n=>{n.addEventListener("blur",function(){P(this)}),n.addEventListener("input",function(){q(this),g()})}),z()});window.nextStep=function(){b()&&u<y&&(u++,v(u),h(u))};window.prevStep=function(){u>1&&(u--,v(u),h(u))};window.navigateToStep=function(e){(e<=u||b())&&(u=e,v(u),h(u))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/courses"):window.location.href=window.location.origin+"/courses"};window.submitForm=function(){if(b()){if(typeof window.actualizarPeriodId=="function"&&window.actualizarPeriodId(),$(),!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};function $(){const e=document.getElementById("requisitos-hidden"),t=document.querySelectorAll(".requisito-chip"),o=Array.from(t).map(s=>s.getAttribute("data-value"));e&&(e.value=o.join(","))}
