let r=1;const l=4;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step"),s(1),d(1),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){k(this)}),t.addEventListener("input",function(){u(this),g()})})});window.nextStep=function(){m()&&r<l&&(r++,s(r),d(r))};window.prevStep=function(){r>1&&(r--,s(r),d(r))};window.navigateToStep=function(e){(e<=r||m())&&(r=e,s(r),d(r))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/incidencias"):window.location.href=window.location.origin+"/incidencias"};function s(e){const t=document.querySelectorAll(".hci-form-section");document.querySelectorAll(".hci-progress-step-vertical"),t.forEach(o=>{o.classList.remove("active")});const n=document.getElementById(D(e));n&&(n.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function d(e){const t=document.getElementById("progress-bar"),n=document.getElementById("progress-percentage"),o=document.getElementById("current-step"),i=e/l*100;t&&(t.style.height=i+"%"),n&&(n.textContent=Math.round(i)+"%"),o&&(o.textContent=`Paso ${e} de ${l}`)}function D(e){return["basica","ubicacion","evidencia","resumen"][e-1]}function m(){const t=document.getElementById(D(r)).querySelectorAll("input[required], select[required], textarea[required]");let n=!0;return t.forEach(o=>{o.value.trim()?u(o):(k(o),n=!1)}),n||A("Por favor, completa todos los campos requeridos antes de continuar."),n}function A(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function k(e){const t=e.checkValidity(),n=e.closest(".hci-field"),o=n==null?void 0:n.querySelector(".hci-field-error");if(t)u(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!o){const i=document.createElement("div");i.className="hci-field-error",i.textContent=e.validationMessage||"Este campo es requerido",n==null||n.appendChild(i)}}function u(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),n=t==null?void 0:t.querySelector(".hci-field-error");n&&n.remove()}function g(){var w,E,I,S,B,x,b,q,L,T,C,P;const e=((w=document.querySelector('input[name="titulo"]'))==null?void 0:w.value)||"",t=((E=document.querySelector('textarea[name="descripcion"]'))==null?void 0:E.value)||"",n=((B=(S=(I=document.querySelector('select[name="magister_id"]'))==null?void 0:I.selectedOptions)==null?void 0:S[0])==null?void 0:B.text)||"",o=((q=(b=(x=document.querySelector('select[name="room_id"]'))==null?void 0:x.selectedOptions)==null?void 0:b[0])==null?void 0:q.text)||"",i=((C=(T=(L=document.querySelector('input[name="imagen"]'))==null?void 0:L.files)==null?void 0:T[0])==null?void 0:C.name)||"",a=((P=document.querySelector('input[name="nro_ticket"]'))==null?void 0:P.value)||"",c=document.getElementById("summary-titulo"),p=document.getElementById("summary-descripcion"),f=document.getElementById("summary-programa"),y=document.getElementById("summary-sala"),v=document.getElementById("summary-imagen"),h=document.getElementById("summary-ticket");c&&(c.textContent=e||"No especificado"),p&&(p.textContent=t||"No especificado"),f&&(f.textContent=n||"No especificado"),y&&(y.textContent=o||"No especificado"),v&&(v.textContent=i||"Sin imagen"),h&&(h.textContent=a||"Sin ticket")}window.submitForm=function(){if(m()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};function F(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function M(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over")}function O(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over");const t=e.dataTransfer.files;if(t.length>0){const n=t[0];N(n)}}function U(e){const t=e.target.files[0];t&&N(t)}function z(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>2*1024*1024?(alert("La imagen no puede exceder los 2MB."),!1):!0:(alert("Por favor, selecciona una imagen JPG, PNG o WEBP."),!1)}function N(e){if(z(e)){const t=new DataTransfer;t.items.add(e),document.getElementById("imagen-input").files=t.files;const n=URL.createObjectURL(e),o=document.getElementById("preview-thumbnail");o&&(o.src=n);const i=document.getElementById("image-name");i&&(i.textContent=e.name);const a=document.getElementById("image-preview");a&&a.classList.remove("hidden");const c=document.getElementById("image-drop-text");c&&(c.textContent="Imagen seleccionada"),g()}}function V(){const e=document.getElementById("imagen-input");e&&(e.value="");const t=document.getElementById("image-preview");t&&t.classList.add("hidden");const n=document.getElementById("image-drop-text");n&&(n.textContent="Arrastra tu imagen aquí"),g()}window.handleDragOver=F;window.handleDragLeave=M;window.handleImageDrop=O;window.handleImageSelect=U;window.clearImage=V;
