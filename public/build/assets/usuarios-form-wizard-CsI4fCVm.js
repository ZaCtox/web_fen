let n=1,u=4;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step");const e=document.querySelector("form").action.includes("usuarios/");if(u=e?3:4,e){const t=document.querySelector('[data-step="3"]');if(t){t.style.opacity="0.5",t.style.pointerEvents="none",t.style.cursor="not-allowed";const i=t.querySelector(".hci-progress-step-content-vertical");if(i){const r=i.querySelector(".hci-progress-step-title");r&&(r.textContent="Sin cambios (Edición)");const c=i.querySelector(".hci-progress-step-desc");c&&(c.textContent="No aplica en edición")}}}s(1),d(1),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){h(this)}),t.addEventListener("input",function(){p(this),q()})})});window.nextStep=function(){f()&&n<u&&(n++,document.querySelector("form").action.includes("usuarios/")&&n===3&&(n=4),s(n),d(n))};window.prevStep=function(){n>1&&(n--,document.querySelector("form").action.includes("usuarios/")&&n===3&&(n=2),s(n),d(n))};window.navigateToStep=function(e){if(document.querySelector("form").action.includes("usuarios/")&&e===3){showStepNotification("En modo edición, el paso 3 no es necesario. Redirigiendo al resumen..."),setTimeout(()=>{navigateToStep(4)},1e3);return}(e<=n||f())&&(n=e,s(n),d(n))};window.cancelForm=function(){confirm("¿Estás seguro de que quieres cancelar? Se perderán todos los datos ingresados.")&&(window.location.href=window.location.origin+"/usuarios")};function s(e){const o=document.querySelectorAll(".hci-form-section"),t=document.querySelectorAll(".hci-progress-step-vertical");if(document.querySelector("form").action.includes("usuarios/")&&e===3){s(4),showStepNotification("Este paso no es necesario en modo edición. Se ha redirigido al resumen.");return}o.forEach(c=>{c.classList.remove("active")});const r=document.getElementById(m(e));r?(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})):console.warn(`No se encontró la sección para el paso ${e}: ${m(e)}`),t.forEach((c,a)=>{a+1<=e?(c.classList.add("completed"),c.classList.add("active")):(c.classList.remove("completed"),c.classList.remove("active"))})}function d(e){const o=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),i=document.getElementById("current-step"),r=e/u*100;o&&(o.style.height=r+"%"),t&&(t.textContent=Math.round(r)+"%"),i&&(i.textContent=`Paso ${e} de ${u}`)}function m(e){return document.querySelector("form").action.includes("usuarios/")?["personal","contacto","resumen"][e-1]:["personal","contacto","adicional","resumen"][e-1]}function f(){const e=document.getElementById(m(n));if(!e)return!0;const o=e.querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return o.forEach(i=>{i.value.trim()?p(i):(h(i),t=!1)}),t||v("Por favor, completa todos los campos requeridos antes de continuar."),t}function v(e){let o=document.getElementById("step-error-message");o||(o=document.createElement("div"),o.id="step-error-message",o.className="hci-error-message",document.querySelector(".hci-container").insertBefore(o,document.querySelector(".hci-wizard-layout"))),o.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{o&&o.remove()},5e3)}function h(e){const o=e.checkValidity(),t=e.closest(".hci-field"),i=t==null?void 0:t.querySelector(".hci-field-error");if(o)p(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!i){const r=document.createElement("div");r.className="hci-field-error",r.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(r)}}function p(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const o=e.closest(".hci-field"),t=o==null?void 0:o.querySelector(".hci-field-error");t&&t.remove()}function q(){var y,E,S;const e=((y=document.querySelector('input[name="name"]'))==null?void 0:y.value)||"",o=((E=document.querySelector('input[name="email"]'))==null?void 0:E.value)||"",t=((S=document.querySelector('select[name="rol"]'))==null?void 0:S.value)||"",i=document.querySelector("form").action.includes("usuarios/"),r=document.getElementById("summary-name"),c=document.getElementById("summary-email"),a=document.getElementById("summary-rol"),l=document.getElementById("summary-password");r&&(r.textContent=e||"No especificado"),c&&(c.textContent=o||"No especificado"),a&&(a.textContent=t||"No especificado"),l&&(i?l.textContent="No se modifica":l.textContent="Se generará automáticamente");const g=document.getElementById("email-notification");g&&(g.textContent=o||"el correo especificado")}window.submitForm=function(){f()&&document.querySelector(".hci-form").submit()};
