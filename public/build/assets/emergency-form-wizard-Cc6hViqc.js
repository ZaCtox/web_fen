let o=1;const c=3;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error, .hci-form-section .text-red-600, .hci-form-section .border-red-500");if(e){const t=e.closest(".hci-form-section");t&&t.dataset.step&&(o=parseInt(t.dataset.step)||1)}a(o),d(o),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){h(this)}),t.addEventListener("input",function(){f(this),u()})}),u()});window.nextStep=function(){m()&&o<c&&(o++,a(o),d(o))};window.prevStep=function(){o>1&&(o--,a(o),d(o))};window.navigateToStep=function(e){(e<=o||m())&&(o=e,a(o),d(o))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/emergencies"):window.location.href=window.location.origin+"/emergencies"};function a(e){document.querySelectorAll(".hci-form-section").forEach(r=>{r.classList.remove("active")});const t=document.getElementById(l(e));t&&(t.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),l(e)==="resumen"&&u()}function d(e){const n=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),s=e/c*100;n&&(n.style.height=s+"%"),t&&(t.textContent=Math.round(s)+"%"),r&&(r.textContent=`Paso ${e} de ${c}`);const i=document.getElementById("prev-btn"),p=document.getElementById("next-btn"),g=document.getElementById("submit-btn");i&&(i.style.display=e>1?"flex":"none"),p&&(p.style.display=e<c?"flex":"none"),g&&(g.style.display=e===c?"flex":"none")}function l(e){return["basica","mensaje","resumen"][e-1]}function m(){const n=document.getElementById(l(o)).querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return n.forEach(r=>{r.value.trim()?f(r):(h(r),t=!1)}),t||y("Por favor, completa todos los campos requeridos antes de continuar."),t}function y(e){let n=document.getElementById("step-error-message");n||(n=document.createElement("div"),n.id="step-error-message",n.className="hci-error-message",document.querySelector(".hci-container").insertBefore(n,document.querySelector(".hci-wizard-layout"))),n.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{n&&n.remove()},5e3)}function h(e){const n=e.checkValidity(),t=e.closest(".hci-field"),r=t==null?void 0:t.querySelector(".hci-field-error");if(n)f(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const s=document.createElement("div");s.className="hci-field-error",s.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(s)}}function f(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const n=e.closest(".hci-field"),t=n==null?void 0:n.querySelector(".hci-field-error");t&&t.remove()}function u(){var s,i;const e=((s=document.querySelector('input[name="title"]'))==null?void 0:s.value)||"",n=((i=document.querySelector('textarea[name="message"]'))==null?void 0:i.value)||"",t=document.getElementById("resumen-titulo"),r=document.getElementById("resumen-mensaje");t&&(t.textContent=e||"No especificado"),r&&(r.textContent=n||"No especificado")}window.submitForm=function(){if(m()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
