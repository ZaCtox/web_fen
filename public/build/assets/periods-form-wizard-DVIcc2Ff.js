let i=1;const l=3,E={1:[1,2,3],2:[4,5,6]};function y(){const e=document.getElementById("anio-select"),n=document.getElementById("numero-select");if(!e||!n)return;const t=parseInt(e.value),r=E[t]||[];n.innerHTML='<option value="">-- Selecciona un trimestre --</option>',r.forEach(function(o){const c=document.createElement("option");c.value=o,c.textContent="Trimestre "+o,n.appendChild(c)}),d()}function d(){const e=document.getElementById("anio-select"),n=document.getElementById("numero-select"),t=document.querySelector('input[name="fecha_inicio"]'),r=document.querySelector('input[name="fecha_fin"]'),o=document.getElementById("summary-anio");o&&e&&(o.textContent=e.value?`Año ${e.value}`:"--");const c=document.getElementById("summary-trimestre");if(c&&n){const h=n.value;if(h){const g={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"}[h];c.textContent=`Trimestre ${g}`}else c.textContent="--"}const s=document.getElementById("summary-fecha-inicio");s&&t&&(s.textContent=t.value?new Date(t.value).toLocaleDateString("es-CL"):"--");const a=document.getElementById("summary-fecha-fin");a&&r&&(a.textContent=r.value?new Date(r.value).toLocaleDateString("es-CL"):"--")}function u(e){const n=document.querySelectorAll(".hci-form-section"),t=document.querySelectorAll(".hci-progress-step-vertical");n.forEach(o=>{o.classList.remove("active")});const r=document.getElementById(v(e));r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),t.forEach((o,c)=>{c+1<=e?(o.classList.add("completed"),o.classList.add("active")):(o.classList.remove("completed"),o.classList.remove("active"))}),I(e)}function I(e){const n=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),o=document.getElementById("prevBtn"),c=document.getElementById("nextBtn"),s=document.getElementById("submitBtn"),a=e/l*100;n&&(n.style.height=a+"%"),t&&(t.textContent=Math.round(a)+"%"),r&&(r.textContent=`Paso ${e} de ${l}`),o&&(o.style.display=e===1?"none":"inline-flex"),c&&(c.style.display=e===l?"none":"inline-flex"),s&&(s.style.display=e===l?"inline-flex":"none")}function v(e){return["informacion","fechas","resumen"][e-1]||"informacion"}window.nextStep=function(){m()&&i<l&&(i++,u(i),d())};window.prevStep=function(){i>1&&(i--,u(i))};window.navigateToStep=function(e){(e<=i||m())&&(i=e,u(i))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/periods"):window.location.href=window.location.origin+"/periods"};function m(){const e=document.getElementById(v(i));if(!e)return!0;const n=e.querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return n.forEach(r=>{r.value.trim()?f(r):(p(r),t=!1)}),t||S("Por favor, completa todos los campos requeridos antes de continuar."),t}function S(e){let n=document.getElementById("step-error-message");if(!n){n=document.createElement("div"),n.id="step-error-message",n.className="hci-error-message";const t=document.querySelector(".hci-container");t&&t.insertBefore(n,document.querySelector(".hci-wizard-layout"))}n.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{n&&n.remove()},5e3)}function p(e){const n=e.checkValidity(),t=e.closest(".hci-field"),r=t==null?void 0:t.querySelector(".hci-field-error");if(n)f(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const o=document.createElement("div");o.className="hci-field-error",o.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(o)}}function f(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const n=e.closest(".hci-field"),t=n==null?void 0:n.querySelector(".hci-field-error");t&&t.remove()}window.submitForm=function(){m()&&document.querySelector(".hci-form").submit()};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("anio-select");e&&e.addEventListener("change",y),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea, input, select, textarea").forEach(t=>{t.addEventListener("blur",function(){this.hasAttribute("required")&&p(this)}),t.addEventListener("input",function(){f(this),d()}),t.addEventListener("change",d)}),y(),u(1),d()});
