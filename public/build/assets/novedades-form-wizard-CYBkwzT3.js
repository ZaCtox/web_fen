let c=1;const u=4;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const i=e.closest(".hci-form-section");i&&i.dataset.step&&(c=parseInt(i.dataset.step)||1)}f(c),v(c),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(i=>{i.addEventListener("blur",function(){k(this)}),i.addEventListener("input",function(){w(this),y()})});const o=document.querySelector('input[name="titulo"]'),r=document.querySelector('textarea[name="contenido"]'),n=document.querySelector('select[name="color"]');document.querySelectorAll('input[name="icono"]').forEach(i=>{i.addEventListener("change",g)}),o&&o.addEventListener("input",g),r&&r.addEventListener("input",g),n&&n.addEventListener("change",g),y()});window.nextStep=function(){h()&&c<u&&(c++,f(c),v(c))};window.prevStep=function(){c>1&&(c--,f(c),v(c))};window.navigateToStep=function(e){(e<=c||h())&&(c=e,f(c),v(c))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/novedades"):window.location.href=window.location.origin+"/novedades"};function f(e){document.querySelectorAll(".hci-form-section").forEach(n=>{n.classList.remove("active")});const o=M(e),r=document.getElementById(o);r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),o==="resumen"&&y()}function v(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),n=e/u*100;t&&(t.style.height=n+"%"),o&&(o.textContent=Math.round(n)+"%"),r&&(r.textContent=`Paso ${e} de ${u}`);const s=document.getElementById("prev-btn"),i=document.getElementById("next-btn"),d=document.getElementById("submit-btn");s&&(s.style.display=e>1?"flex":"none"),i&&(i.style.display=e<u?"flex":"none"),d&&(d.style.display=e===u?"flex":"none")}function M(e){return["basica","configuracion","diseno","resumen"][e-1]}function h(){console.log(`üîç validateCurrentStep() - Paso ${c}`);const e=M(c);console.log(`üìã ID de secci√≥n: ${e}`);const t=document.getElementById(e);console.log("üìÑ Secci√≥n encontrada:",t);const o=t==null?void 0:t.querySelectorAll("input[required], select[required], textarea[required]");console.log("üìù Campos requeridos encontrados:",(o==null?void 0:o.length)||0);let r=!0;return o&&o.forEach((n,s)=>{console.log(`üîç Campo ${s+1}:`,n.name,"=",n.value),n.value.trim()?(console.log(`‚úÖ Campo ${n.name} tiene valor`),w(n)):(console.log(`‚ùå Campo ${n.name} est√° vac√≠o`),k(n),r=!1)}),console.log(`üéØ Paso ${c} es v√°lido:`,r),r||(console.log("‚ùå Mostrando error de validaci√≥n"),A("Por favor, completa todos los campos requeridos antes de continuar.")),r}function A(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function k(e){const t=e.checkValidity(),o=e.closest(".hci-field"),r=o==null?void 0:o.querySelector(".hci-field-error");if(t)w(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const n=document.createElement("div");n.className="hci-field-error",n.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(n)}}function w(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function y(){var x,q,C,B,L,P,N,$,T;const e=((x=document.querySelector('input[name="titulo"]'))==null?void 0:x.value)||"",t=((q=document.querySelector('textarea[name="contenido"]'))==null?void 0:q.value)||"",o=((C=document.querySelector('select[name="tipo_novedad"]'))==null?void 0:C.value)||"",r=((B=document.querySelector('input[name="es_urgente"]'))==null?void 0:B.checked)||!1,n=((L=document.querySelector('input[name="visible_publico"]'))==null?void 0:L.checked)||!1,s=((P=document.querySelector('input[name="icono"]'))==null?void 0:P.value)||"üì∞",i=((N=document.querySelector('select[name="color"]'))==null?void 0:N.value)||"blue",d=((T=($=document.querySelector('select[name="magister_id"]'))==null?void 0:$.selectedOptions[0])==null?void 0:T.text)||"No especificado",l=document.getElementById("resumen-titulo"),a=document.getElementById("resumen-contenido"),m=document.getElementById("resumen-tipo"),p=document.getElementById("resumen-urgente"),S=document.getElementById("resumen-visibilidad"),b=document.getElementById("resumen-icono"),E=document.getElementById("resumen-color"),I=document.getElementById("resumen-programa");l&&(l.textContent=e||"No especificado"),a&&(a.textContent=t||"No especificado"),m&&(m.textContent=o||"No especificado"),p&&(p.textContent=r?"S√≠":"No"),S&&(S.textContent=n?"P√∫blico":"Privado"),b&&(b.textContent=s),E&&(E.textContent=i),I&&(I.textContent=d)}function g(){var d,l,a;const e=((d=document.querySelector('input[name="titulo"]'))==null?void 0:d.value)||"T√≠tulo de la novedad";(l=document.querySelector('textarea[name="contenido"]'))!=null&&l.value;const t=((a=document.querySelector('select[name="color"]'))==null?void 0:a.value)||"blue",o=document.querySelector('input[name="icono"]:checked'),r=(o==null?void 0:o.value)||"üì∞",n=document.getElementById("preview-icon"),s=document.getElementById("preview-titulo"),i=document.getElementById("preview-color");if(n&&(n.textContent=r),s&&(s.textContent=e),i){const m={blue:"bg-blue-500",green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500",purple:"bg-purple-500",indigo:"bg-indigo-500"},p={blue:"Azul",green:"Verde",yellow:"Amarillo",red:"Rojo",purple:"Morado",indigo:"√çndigo"};i.className=`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${m[t]} text-white`,i.textContent=p[t]}}window.submitForm=function(){if(h()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
