let i=1;const m=3;let r=0;window.addEntryToContainer=function(e=null){r++;const o=document.getElementById("entradas-container"),t=(e==null?void 0:e.location_type)||"",n=(e==null?void 0:e.room_id)||"",a=(e==null?void 0:e.location_detail)||"",g=(e==null?void 0:e.observation)||"",l=(e==null?void 0:e.photo_url)||"";let c='<option value="">Seleccione una sala específica</option>';window.dailyReportsData&&window.dailyReportsData.rooms&&window.dailyReportsData.rooms.forEach(s=>{const d=s.id==n?"selected":"";c+='<option value="'+s.id+'" '+d+">"+s.name+"</option>"});const E='<div class="entrada-item border border-gray-200 dark:border-gray-600 rounded-lg p-4 mb-4 bg-gray-50 dark:bg-gray-700" data-index="'+r+'"><div class="flex justify-between items-center mb-4"><h4 class="text-md font-medium text-gray-900 dark:text-gray-100">Observación #'+r+`</h4><button type="button" onclick="this.closest('.entrada-item').remove()" class="hci-button hci-lift hci-focus-ring p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-200" title="Eliminar observación"><img src="/icons/trashw.svg" alt="Eliminar" class="w-4 h-4"></button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Ubicación <span class="text-red-500">*</span></label><select name="entries[`+r+'][location_type]" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" onchange="toggleLocationFields'+r+'(this)" required><option value="">Seleccione el tipo de ubicación</option><option value="Sala"'+(t==="Sala"?" selected":"")+'>Sala de Clases</option><option value="Baño"'+(t==="Baño"?" selected":"")+'>Baño</option><option value="Pasillo"'+(t==="Pasillo"?" selected":"")+'>Pasillo</option><option value="Laboratorio"'+(t==="Laboratorio"?" selected":"")+'>Laboratorio</option><option value="Oficina"'+(t==="Oficina"?" selected":"")+'>Oficina</option><option value="Otro"'+(t==="Otro"?" selected":"")+'>Otro</option></select></div><div id="sala-field-'+r+'" class="'+(t==="Sala"?"":"hidden")+'"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Seleccionar Sala</label><select name="entries['+r+'][room_id]" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200">'+c+'</select></div><div id="detalle-field-'+r+'" class="'+(["Baño","Pasillo","Laboratorio","Oficina","Otro"].includes(t)?"":"hidden")+'"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Detalle de Ubicación</label><input type="text" name="entries['+r+'][location_detail]" value="'+a+'" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Ej: Baño primer piso, Pasillo edificio A"></div></div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observación <span class="text-red-500">*</span></label><textarea name="entries['+r+'][observation]" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#4d82bc] focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all duration-200" placeholder="Describe lo observado (mínimo 5 caracteres)..." required>'+g+"</textarea></div>"+(l?'<div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Imagen Actual</label><img src="'+l+'" alt="Imagen actual" class="max-w-xs h-auto rounded-lg shadow-md"></div>':"")+'<div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">'+(l?"Reemplazar Imagen (Opcional)":"Evidencia Fotográfica (Opcional)")+'</label><div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg hover:border-[#4d82bc] transition-colors duration-200"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-gray-600 dark:text-gray-400"><label for="photo-'+r+'" class="relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-[#4d82bc] hover:text-[#005187] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[#4d82bc]"><span>Subir una foto</span><input id="photo-'+r+'" name="entries['+r+'][photo]" type="file" accept="image/*" class="sr-only" onchange="previewImage'+r+'(this)"></label><p class="pl-1">o arrastra y suelta</p></div><p class="text-xs text-gray-500 dark:text-gray-400">PNG, JPG, GIF hasta 10MB</p></div></div><div id="image-preview-'+r+'" class="mt-4 text-center hidden"><img id="preview-img-'+r+'" src="" alt="Preview" class="mx-auto h-32 w-32 object-cover rounded-lg shadow"><p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Vista previa</p></div></div></div>';o.insertAdjacentHTML("beforeend",E),window["toggleLocationFields"+r]=function(s){const d=r,u=s.value,p=document.getElementById("sala-field-"+d),f=document.getElementById("detalle-field-"+d);p.classList.add("hidden"),f.classList.add("hidden"),u==="Sala"?p.classList.remove("hidden"):["Baño","Pasillo","Laboratorio","Oficina","Otro"].includes(u)&&f.classList.remove("hidden")},window["previewImage"+r]=function(s){const d=s.files[0];if(d){const u=new FileReader;u.onload=function(p){const f=document.getElementById("image-preview-"+r),S=document.getElementById("preview-img-"+r);S.src=p.target.result,f.classList.remove("hidden")},u.readAsDataURL(d)}}};document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const t=e.closest(".hci-form-section");t&&t.dataset.step&&(i=parseInt(t.dataset.step)||1)}b(i),v(i),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(t=>{t.addEventListener("blur",function(){k(this)}),t.addEventListener("input",function(){w(this)})})});window.nextStep=function(){h()&&i<m&&(i++,b(i),v(i))};window.prevStep=function(){i>1&&(i--,b(i),v(i))};window.navigateToStep=function(e){(e<=i||h())&&(i=e,b(i),v(i))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/daily-reports"):window.location.href=window.location.origin+"/daily-reports"};function b(e){document.querySelectorAll(".hci-form-section").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(x(e));t&&(t.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function v(e){const o=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),n=document.getElementById("current-step"),a=e/m*100;o&&(o.style.height=a+"%"),t&&(t.textContent=Math.round(a)+"%"),n&&(n.textContent=`Paso ${e} de ${m}`);const g=document.getElementById("prev-btn"),l=document.getElementById("next-btn"),c=document.getElementById("submit-btn");g&&(g.style.display=e>1?"flex":"none"),l&&(l.style.display=e<m?"flex":"none"),c&&(c.style.display=e===m?"flex":"none")}function x(e){return["informacion","observaciones","resumen"][e-1]}function h(){const e=document.getElementById(x(i));if(!e||i===3)return!0;const o=e.querySelectorAll("input[required], select[required], textarea[required]");let t=!0;return o.forEach(n=>{n.value.trim()?w(n):(k(n),t=!1)}),i===2&&document.querySelectorAll(".entrada-item").length===0&&(y("Debe agregar al menos una observación."),t=!1),t||y("Por favor, completa todos los campos requeridos antes de continuar."),t}function y(e){let o=document.getElementById("step-error-message");if(!o){o=document.createElement("div"),o.id="step-error-message",o.className="hci-error-message";const t=document.querySelector(".hci-container");t&&t.insertBefore(o,document.querySelector(".hci-wizard-layout"))}o.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{o&&o.remove()},5e3)}function k(e){const o=e.checkValidity(),t=e.closest(".hci-field"),n=t==null?void 0:t.querySelector(".hci-field-error");if(o)w(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!n){const a=document.createElement("div");a.className="hci-field-error",a.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(a)}}function w(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const o=e.closest(".hci-field"),t=o==null?void 0:o.querySelector(".hci-field-error");t&&t.remove()}window.submitForm=function(){if(console.log("submitForm called"),h()){console.log("Validation passed, submitting form");const e=document.querySelector(".hci-form");console.log("Form found:",e),e.submit()}else console.log("Validation failed")};document.addEventListener("DOMContentLoaded",function(){window.dailyReportsData&&window.dailyReportsData.entries&&(window.dailyReportsData.entries.length===0?window.addEntryToContainer():window.dailyReportsData.entries.forEach(e=>{window.addEntryToContainer(e)}))});
