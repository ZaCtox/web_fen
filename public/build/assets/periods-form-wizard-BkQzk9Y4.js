let s=1;const r=3,I={1:[1,2,3],2:[4,5,6]};function h(){const e=document.getElementById("anio-select"),t=document.getElementById("numero-select");if(!e||!t)return;const n=parseInt(e.value),c=I[n]||[];t.innerHTML='<option value="">-- Selecciona un trimestre --</option>',c.forEach(function(i){const o=document.createElement("option");o.value=i,o.textContent="Trimestre "+i,t.appendChild(o)}),d()}function d(){const e=document.getElementById("anio-select"),t=document.getElementById("numero-select"),n=document.querySelector('input[name="fecha_inicio"]'),c=document.querySelector('input[name="fecha_fin"]'),i=document.getElementById("summary-anio");i&&e&&(i.textContent=e.value?`Año ${e.value}`:"--");const o=document.getElementById("summary-trimestre");if(o&&t){const u=t.value;if(u){const m={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"}[u];o.textContent=`Trimestre ${m}`}else o.textContent="--"}const l=document.getElementById("summary-fecha-inicio");l&&n&&(l.textContent=n.value?new Date(n.value).toLocaleDateString("es-CL"):"--");const a=document.getElementById("summary-fecha-fin");a&&c&&(a.textContent=c.value?new Date(c.value).toLocaleDateString("es-CL"):"--")}function g(e){console.log(`🎯 Showing step ${e}`);const t=document.querySelectorAll(".hci-form-section"),n=document.querySelectorAll(".hci-progress-step-vertical"),c=document.getElementById("progress-bar"),i=document.getElementById("current-step"),o=document.getElementById("progress-percentage"),l=document.getElementById("prevBtn"),a=document.getElementById("nextBtn"),u=document.getElementById("submitBtn");console.log(`📋 Found ${t.length} sections`),t.forEach((f,y)=>{f.style.display="none",console.log(`❌ Hidden section ${y+1}`)});const m=document.getElementById(p(e));m?(m.style.display="block",console.log(`✅ Showing section: ${p(e)}`)):console.log(`❌ Section not found: ${p(e)}`),n.forEach((f,y)=>{y+1<=e?f.classList.add("active"):f.classList.remove("active")});const S=e/r*100;c&&(c.style.height=`${S}%`),i&&(i.textContent=`Paso ${e} de ${r}`),o&&(o.textContent=`${Math.round(S)}%`),l&&(l.style.display=e===1?"none":"inline-flex"),a&&(a.style.display=e===r?"none":"inline-flex"),u&&(u.style.display=e===r?"inline-flex":"none")}function p(e){return["informacion","fechas","resumen"][e-1]||"informacion"}function v(){s<r&&(s++,g(s))}function E(){s>1&&(s--,g(s))}function B(e){e>=1&&e<=r&&(s=e,g(s))}function w(){confirm("¿Estás seguro de que quieres cancelar? Se perderán los datos no guardados.")&&(window.location.href="/periods")}function x(){d();const e=document.querySelectorAll("[required]");let t=!0;if(e.forEach(n=>{n.value.trim()?n.classList.remove("border-red-500"):(n.classList.add("border-red-500"),t=!1)}),!t){alert("Por favor, completa todos los campos requeridos.");return}document.querySelector(".hci-form").submit()}window.nextStep=v;window.prevStep=E;window.navigateToStep=B;window.cancelForm=w;window.submitForm=x;document.addEventListener("DOMContentLoaded",function(){console.log("🚀 Periods Form Wizard JavaScript loaded!");const e=document.getElementById("anio-select");e?(console.log("✅ Año select found"),e.addEventListener("change",h)):console.log("❌ Año select NOT found");const t=document.querySelectorAll("input, select");console.log(`📝 Found ${t.length} form fields`),t.forEach(n=>{n.addEventListener("change",d),n.addEventListener("input",d)}),h(),setTimeout(()=>{console.log("🎯 Showing step 1"),g(1),d()},100)});
