let r=1;const p=4;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step"),m(1),g(1),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(s=>{s.addEventListener("blur",function(){M(this)}),s.addEventListener("input",function(){f(this),D()})});const e=document.querySelector('input[name="titulo"]'),t=document.querySelector('textarea[name="contenido"]'),c=document.querySelector('input[name="icono"]'),n=document.querySelector('select[name="color"]');e&&e.addEventListener("input",u),t&&t.addEventListener("input",u),c&&c.addEventListener("input",u),n&&n.addEventListener("change",u)});window.nextStep=function(){v()&&r<p&&(r++,m(r),g(r))};window.prevStep=function(){r>1&&(r--,m(r),g(r))};window.navigateToStep=function(o){(o<=r||v())&&(r=o,m(r),g(r))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/novedades"):window.location.href=window.location.origin+"/novedades"};function m(o){console.log(`üé¨ showStep() llamado con paso: ${o}`);const e=document.querySelectorAll(".hci-form-section"),t=document.querySelectorAll(".hci-progress-step-vertical");console.log(`üìÑ Secciones encontradas: ${e.length}`),console.log(`üìä Pasos de progreso encontrados: ${t.length}`),e.forEach(s=>{s.classList.remove("active")});const c=T(o);console.log(`üîç Buscando secci√≥n con ID: ${c}`);const n=document.getElementById(c);console.log("üìÑ Secci√≥n encontrada:",n),n?(n.classList.add("active"),console.log(`‚úÖ Secci√≥n ${c} marcada como activa`),n.scrollIntoView({behavior:"smooth",block:"start"}),console.log("üìú Scroll realizado")):console.error(`‚ùå No se encontr√≥ la secci√≥n con ID: ${c}`),t.forEach((s,i)=>{i+1<=o?(s.classList.add("completed"),s.classList.add("active")):(s.classList.remove("completed"),s.classList.remove("active"))}),console.log("üìä Progreso vertical actualizado")}function g(o){const e=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),c=document.getElementById("current-step"),n=o/p*100;e&&(e.style.height=n+"%"),t&&(t.textContent=Math.round(n)+"%"),c&&(c.textContent=`Paso ${o} de ${p}`)}function T(o){return["basica","configuracion","diseno","resumen"][o-1]}function v(){console.log(`üîç validateCurrentStep() - Paso ${r}`);const o=T(r);console.log(`üìã ID de secci√≥n: ${o}`);const e=document.getElementById(o);console.log("üìÑ Secci√≥n encontrada:",e);const t=e==null?void 0:e.querySelectorAll("input[required], select[required], textarea[required]");console.log("üìù Campos requeridos encontrados:",(t==null?void 0:t.length)||0);let c=!0;return t&&t.forEach((n,s)=>{console.log(`üîç Campo ${s+1}:`,n.name,"=",n.value),n.value.trim()?(console.log(`‚úÖ Campo ${n.name} tiene valor`),f(n)):(console.log(`‚ùå Campo ${n.name} est√° vac√≠o`),M(n),c=!1)}),console.log(`üéØ Paso ${r} es v√°lido:`,c),c||(console.log("‚ùå Mostrando error de validaci√≥n"),A("Por favor, completa todos los campos requeridos antes de continuar.")),c}function A(o){let e=document.getElementById("step-error-message");e||(e=document.createElement("div"),e.id="step-error-message",e.className="hci-error-message",document.querySelector(".hci-container").insertBefore(e,document.querySelector(".hci-wizard-layout"))),e.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${o}</span>
        </div>
    `,setTimeout(()=>{e&&e.remove()},5e3)}function M(o){const e=o.checkValidity(),t=o.closest(".hci-field"),c=t==null?void 0:t.querySelector(".hci-field-error");if(e)f(o);else if(o.classList.add("border-red-500"),o.classList.remove("border-gray-300"),!c){const n=document.createElement("div");n.className="hci-field-error",n.textContent=o.validationMessage||"Este campo es requerido",t==null||t.appendChild(n)}}function f(o){o.classList.remove("border-red-500"),o.classList.add("border-gray-300");const e=o.closest(".hci-field"),t=e==null?void 0:e.querySelector(".hci-field-error");t&&t.remove()}function D(){var q,x,I,C,B,$,L,P,N;const o=((q=document.querySelector('input[name="titulo"]'))==null?void 0:q.value)||"",e=((x=document.querySelector('textarea[name="contenido"]'))==null?void 0:x.value)||"",t=((I=document.querySelector('select[name="tipo_novedad"]'))==null?void 0:I.value)||"",c=((C=document.querySelector('input[name="es_urgente"]'))==null?void 0:C.checked)||!1,n=((B=document.querySelector('input[name="visible_publico"]'))==null?void 0:B.checked)||!1,s=(($=document.querySelector('input[name="icono"]'))==null?void 0:$.value)||"üì∞",i=((L=document.querySelector('select[name="color"]'))==null?void 0:L.value)||"blue",a=((N=(P=document.querySelector('select[name="magister_id"]'))==null?void 0:P.selectedOptions[0])==null?void 0:N.text)||"No especificado",l=document.getElementById("resumen-titulo"),d=document.getElementById("resumen-contenido"),y=document.getElementById("resumen-tipo"),h=document.getElementById("resumen-urgente"),S=document.getElementById("resumen-visibilidad"),E=document.getElementById("resumen-icono"),w=document.getElementById("resumen-color"),b=document.getElementById("resumen-programa");l&&(l.textContent=o||"No especificado"),d&&(d.textContent=e||"No especificado"),y&&(y.textContent=t||"No especificado"),h&&(h.textContent=c?"S√≠":"No"),S&&(S.textContent=n?"P√∫blico":"Privado"),E&&(E.textContent=s),w&&(w.textContent=i),b&&(b.textContent=a)}function u(){var s,i,a,l;const o=((s=document.querySelector('input[name="titulo"]'))==null?void 0:s.value)||"T√≠tulo de la novedad",e=((i=document.querySelector('textarea[name="contenido"]'))==null?void 0:i.value)||"Contenido de la novedad...",t=((a=document.querySelector('input[name="icono"]'))==null?void 0:a.value)||"üì∞",c=((l=document.querySelector('select[name="color"]'))==null?void 0:l.value)||"blue",n=document.getElementById("novedad-preview");if(n){const d={blue:"bg-blue-500",green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500",purple:"bg-purple-500",indigo:"bg-indigo-500"};n.innerHTML=`
            <div class="bg-white border rounded-lg p-4 shadow-md">
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-3">${t}</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-900">${o}</h3>
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${d[c]} text-white">
                            ${c}
                        </span>
                    </div>
                </div>
                <p class="text-sm text-gray-600">${e.substring(0,150)}${e.length>150?"...":""}</p>
            </div>
        `}}window.submitForm=function(){v()&&document.querySelector(".hci-form").submit()};
