let s=1;const I=3;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step-vertical"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step");const e=document.querySelector(".hci-form-section .hci-field-error, .hci-form-section .text-red-600, .hci-form-section .border-red-500");if(e){const c=e.closest(".hci-form-section");c&&c.dataset.step&&(s=parseInt(c.dataset.step)||1)}v(s),h(s);const t=window.PERIODS||[],o={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"},r=document.getElementById("anio"),i=document.getElementById("numero"),l=document.getElementById("period_id"),u=document.getElementById("magister_id"),p=document.getElementById("malla_curricular_id");let m=null;function f(){if(!u||!p)return;const c=u.value;p.querySelectorAll("option").forEach(n=>{if(n.value===""){n.style.display="block";return}n.getAttribute("data-magister")===c?n.style.display="block":(n.style.display="none",n.selected&&(p.value=""))})}u&&(u.addEventListener("change",()=>{f(),y()}),f());function g(){const c=r.value;if(i.innerHTML='<option value="">-- Selecciona un trimestre --</option>',!c)return;t.filter(n=>n.anio==c).map(n=>({numero:n.numero,id:n.id})).sort((n,d)=>n.numero-d.numero).forEach(n=>{const d=document.createElement("option");d.value=n.numero,d.textContent=`Trimestre ${o[n.numero]||n.numero}`,i.appendChild(d)}),m&&(i.value=m,m=null),window.actualizarPeriodId()}if(window.actualizarPeriodId=function(){const c=r.value,a=i.value,n=t.find(d=>d.anio==c&&d.numero==a);l.value=n?n.id:"",console.log("Actualizando period_id:",{anio:c,numero:a,periodId:l.value,periodo:n})},r&&i&&l){r.addEventListener("change",()=>{g(),y()}),i.addEventListener("change",()=>{window.actualizarPeriodId(),y()});const c=l.value;if(c){const a=t.find(n=>n.id==c);a&&(r.value=a.anio,m=a.numero,g())}}document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(c=>{c.addEventListener("blur",function(){T(this)}),c.addEventListener("input",function(){E(this),y()})})});window.nextStep=function(){w()&&s<I&&(s++,v(s),h(s))};window.prevStep=function(){s>1&&(s--,v(s),h(s))};window.navigateToStep=function(e){(e<=s||w())&&(s=e,v(s),h(s))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/courses"):window.location.href=window.location.origin+"/courses"};function v(e){const t=document.querySelectorAll(".hci-form-section");document.querySelectorAll(".hci-progress-step-vertical"),t.forEach(r=>{r.classList.remove("active")});const o=document.getElementById(C(e));o&&(o.classList.add("active"),o.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function h(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),i=e/I*100;t&&(t.style.height=i+"%"),o&&(o.textContent=Math.round(i)+"%"),r&&(r.textContent=`Paso ${e} de ${I}`)}function C(e){return["basica","programa","resumen"][e-1]}function w(){const t=document.getElementById(C(s)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(r=>{r.value.trim()?E(r):(T(r),o=!1)}),o||z("Por favor, completa todos los campos requeridos antes de continuar."),o}function z(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function T(e){const t=e.checkValidity(),o=e.closest(".hci-field"),r=o==null?void 0:o.querySelector(".hci-field-error");if(t)E(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const i=document.createElement("div");i.className="hci-field-error",i.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(i)}}function E(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function y(){var n,d,b,q,x,B,L,P;const e=((n=document.querySelector('input[name="nombre"]'))==null?void 0:n.value)||"";(d=document.querySelector('select[name="magister_id"]'))!=null&&d.value,(b=document.querySelector('select[name="anio"]'))!=null&&b.value,(q=document.querySelector('select[name="numero"]'))!=null&&q.value;const t=document.querySelector('select[name="magister_id"]'),o=document.querySelector('select[name="malla_curricular_id"]'),r=document.querySelector('select[name="anio"]'),i=document.querySelector('select[name="numero"]'),l=((x=t==null?void 0:t.selectedOptions[0])==null?void 0:x.text)||"No seleccionado",u=((B=o==null?void 0:o.selectedOptions[0])==null?void 0:B.text)||"Sin malla específica",p=((L=r==null?void 0:r.selectedOptions[0])==null?void 0:L.text)||"No seleccionado",m=((P=i==null?void 0:i.selectedOptions[0])==null?void 0:P.text)||"No seleccionado",f=document.getElementById("resumen-nombre"),g=document.getElementById("resumen-programa"),S=document.getElementById("resumen-malla"),c=document.getElementById("resumen-anio"),a=document.getElementById("resumen-trimestre");f&&(f.textContent=e||"No especificado"),g&&(g.textContent=l),S&&(S.textContent=u),c&&(c.textContent=p),a&&(a.textContent=m)}window.submitForm=function(){if(w()){if(typeof window.actualizarPeriodId=="function"&&window.actualizarPeriodId(),!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                    <div class="loading-overlay-content">
                        <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                        <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                    </div>
                `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
