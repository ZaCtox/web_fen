let u=1;const I=3;function h(e){const t=document.querySelectorAll(".hci-form-section");document.querySelectorAll(".hci-progress-step-vertical"),t.forEach(s=>{s.classList.remove("active")});const n=document.getElementById(z(e));n&&(n.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e)}function b(e){const t=document.getElementById("progress-bar"),n=document.getElementById("progress-percentage"),s=document.getElementById("current-step"),i=e/I*100;t&&(t.style.height=i+"%"),n&&(n.textContent=Math.round(i)+"%"),s&&(s.textContent=`Paso ${e} de ${I}`)}function z(e){return["basica","programa","resumen"][e-1]}function E(){const t=document.getElementById(z(u)).querySelectorAll("input[required], select[required], textarea[required]");let n=!0;return t.forEach(s=>{s.value.trim()?q(s):(H(s),n=!1)}),n||V("Por favor, completa todos los campos requeridos antes de continuar."),n}function V(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function H(e){const t=e.checkValidity(),n=e.closest(".hci-field"),s=n==null?void 0:n.querySelector(".hci-field-error");if(t)q(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!s){const i=document.createElement("div");i.className="hci-field-error",i.textContent=e.validationMessage||"Este campo es requerido",n==null||n.appendChild(i)}}function q(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),n=t==null?void 0:t.querySelector(".hci-field-error");n&&n.remove()}function y(){var x,w,L,B,A,k,T,C,M;const e=((x=document.querySelector('input[name="nombre"]'))==null?void 0:x.value)||"",t=((w=document.querySelector('input[name="sct"]'))==null?void 0:w.value)||"";document.querySelector('select[name="requisitos[]"]'),(L=document.querySelector('select[name="magister_id"]'))!=null&&L.value,(B=document.querySelector('select[name="anio"]'))!=null&&B.value,(A=document.querySelector('select[name="numero"]'))!=null&&A.value;const n=document.querySelector('select[name="magister_id"]'),s=document.querySelector('select[name="malla_curricular_id"]'),i=document.querySelector('select[name="anio"]'),m=document.querySelector('select[name="numero"]'),g=((k=n==null?void 0:n.selectedOptions[0])==null?void 0:k.text)||"No seleccionado",v=((T=s==null?void 0:s.selectedOptions[0])==null?void 0:T.text)||"Sin malla espec√≠fica",o=((C=i==null?void 0:i.selectedOptions[0])==null?void 0:C.text)||"No seleccionado",d=((M=m==null?void 0:m.selectedOptions[0])==null?void 0:M.text)||"No seleccionado",a=document.getElementById("resumen-nombre"),p=document.getElementById("resumen-sct"),c=document.getElementById("resumen-requisitos"),l=document.getElementById("resumen-programa"),r=document.getElementById("resumen-malla"),f=document.getElementById("resumen-anio"),S=document.getElementById("resumen-trimestre");if(a&&(a.textContent=e||"No especificado"),p&&(t?p.innerHTML=`${t} cr√©ditos`:p.innerHTML='<span class="text-gray-400">No especificado</span>'),c){const P=document.querySelectorAll(".requisito-chip");P.length>0?c.innerHTML=Array.from(P).map(N=>{const _=N.getAttribute("data-value"),$=N.textContent.trim();return _==="ingreso"?'<span class="inline-flex items-center px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 text-sm font-medium rounded-full">üéì Ingreso</span>':`<span class="inline-flex items-center px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-sm font-medium rounded-full">${$}</span>`}).join(""):c.innerHTML='<span class="text-gray-400">No especificado</span>'}l&&(l.textContent=g),r&&(r.textContent=v),f&&(f.textContent=o),S&&(S.textContent=d)}function R(){const e=document.getElementById("requisitos-search"),t=document.getElementById("requisitos-dropdown"),n=document.getElementById("requisitos-selected"),s=document.getElementById("requisitos-hidden");if(!e||!t||!n)return;let i=[];document.querySelectorAll(".requisito-chip").forEach(o=>{const d=o.getAttribute("data-value");d&&i.push(d)});function m(){s.value=i.join(",")}function g(o,d){if(i.includes(o))return;i.push(o),m();const a=document.createElement("span");a.className="requisito-chip inline-flex items-center gap-1 px-3 py-1 text-sm font-medium rounded-full",a.setAttribute("data-value",o),o==="ingreso"?(a.className+=" bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200",a.innerHTML='üéì Ingreso <button type="button" class="requisito-remove hover:text-green-600 dark:hover:text-green-400" data-value="ingreso">√ó</button>'):(a.className+=" bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200",a.innerHTML=`${d} <button type="button" class="requisito-remove hover:text-blue-600 dark:hover:text-blue-400" data-value="${o}">√ó</button>`),n.appendChild(a),a.querySelector(".requisito-remove").addEventListener("click",()=>v(o)),y()}function v(o){i=i.filter(a=>a!==o),m();const d=n.querySelector(`[data-value="${o}"]`);d&&d.remove(),y()}e.addEventListener("input",function(){const o=this.value.toLowerCase(),d=t.querySelectorAll(".requisito-option");let a=!1;d.forEach(p=>{const c=p.getAttribute("data-text").toLowerCase(),l=p.getAttribute("data-value");c.includes(o)&&!i.includes(l)?(p.style.display="block",a=!0):p.style.display="none"}),t.classList.toggle("hidden",!a||o==="")}),t.addEventListener("click",function(o){const d=o.target.closest(".requisito-option");if(!d)return;const a=d.getAttribute("data-value"),p=d.getAttribute("data-text");g(a,p),e.value="",t.classList.add("hidden")}),n.addEventListener("click",function(o){if(o.target.classList.contains("requisito-remove")){const d=o.target.getAttribute("data-value");v(d)}}),document.addEventListener("click",function(o){!e.contains(o.target)&&!t.contains(o.target)&&t.classList.add("hidden")}),e.addEventListener("focus",function(){this.value===""&&t.classList.remove("hidden")}),m()}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step-vertical"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step");const e=document.querySelector(".hci-form-section .hci-field-error, .hci-form-section .text-red-600, .hci-form-section .border-red-500");if(e){const c=e.closest(".hci-form-section");c&&c.dataset.step&&(u=parseInt(c.dataset.step)||1)}h(u),b(u);const t=window.PERIODS||[],n={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"},s=document.getElementById("anio"),i=document.getElementById("numero"),m=document.getElementById("period_id"),g=document.getElementById("magister_id"),v=document.getElementById("malla_curricular_id");let o=null;function d(){if(!g||!v)return;const c=g.value;v.querySelectorAll("option").forEach(r=>{if(r.value===""){r.style.display="block";return}r.getAttribute("data-magister")===c?r.style.display="block":(r.style.display="none",r.selected&&(v.value=""))})}g&&(g.addEventListener("change",()=>{d(),y()}),d());function a(){const c=s.value;if(i.innerHTML='<option value="">-- Selecciona un trimestre --</option>',!c)return;t.filter(r=>r.anio==c).map(r=>({numero:r.numero,id:r.id})).sort((r,f)=>r.numero-f.numero).forEach(r=>{const f=document.createElement("option");f.value=r.numero,f.textContent=`Trimestre ${n[r.numero]||r.numero}`,i.appendChild(f)}),o&&(i.value=o,o=null),window.actualizarPeriodId()}if(window.actualizarPeriodId=function(){const c=s.value,l=i.value,r=t.find(f=>f.anio==c&&f.numero==l);m.value=r?r.id:"",console.log("Actualizando period_id:",{anio:c,numero:l,periodId:m.value,periodo:r})},s&&i&&m){s.addEventListener("change",()=>{a(),y()}),i.addEventListener("change",()=>{window.actualizarPeriodId(),y()});const c=m.value;if(c){const l=t.find(r=>r.id==c);l&&(s.value=l.anio,o=l.numero,a())}}document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(c=>{c.addEventListener("blur",function(){H(this)}),c.addEventListener("input",function(){q(this),y()})}),R()});window.nextStep=function(){E()&&u<I&&(u++,h(u),b(u))};window.prevStep=function(){u>1&&(u--,h(u),b(u))};window.navigateToStep=function(e){(e<=u||E())&&(u=e,h(u),b(u))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/courses"):window.location.href=window.location.origin+"/courses"};window.submitForm=function(){if(E()){if(typeof window.actualizarPeriodId=="function"&&window.actualizarPeriodId(),O(),!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};function O(){const e=document.getElementById("requisitos-hidden"),t=document.querySelectorAll(".requisito-chip"),n=Array.from(t).map(s=>s.getAttribute("data-value"));e&&(e.value=n.join(","))}
