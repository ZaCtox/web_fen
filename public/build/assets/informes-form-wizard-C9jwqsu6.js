let c=1;const d=3;document.addEventListener("DOMContentLoaded",function(){console.log("üöÄ Informes form wizard loaded");const e=document.querySelectorAll(".hci-form-section"),t=document.querySelectorAll(".hci-progress-step");document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step"),console.log("üìã Found sections:",e.length),console.log("üìä Found progress steps:",t.length),a(1),l(1),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(n=>{n.addEventListener("blur",function(){S(this)}),n.addEventListener("input",function(){m(this),g()})})});window.nextStep=function(){u()&&c<d&&(c++,a(c),l(c))};window.prevStep=function(){c>1&&(c--,a(c),l(c))};window.navigateToStep=function(e){(e<=c||u())&&(c=e,a(c),l(c))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/informes"):window.location.href=window.location.origin+"/informes"};function a(e){console.log("üéØ Showing step:",e);const t=document.querySelectorAll(".hci-form-section"),o=document.querySelectorAll(".hci-progress-step-vertical");console.log("üìã Total sections found:",t.length),t.forEach(s=>{s.classList.remove("active"),console.log("‚ùå Hiding section:",s.id)});const n=E(e);console.log("üîç Looking for section ID:",n);const r=document.getElementById(n);r?(r.classList.add("active"),console.log("‚úÖ Showing section:",n),r.scrollIntoView({behavior:"smooth",block:"start"})):console.error("‚ùå Section not found:",n),o.forEach((s,i)=>{i+1<=e?(s.classList.add("completed"),s.classList.add("active")):(s.classList.remove("completed"),s.classList.remove("active"))})}function l(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),n=document.getElementById("current-step"),r=e/d*100;t&&(t.style.height=r+"%"),o&&(o.textContent=Math.round(r)+"%"),n&&(n.textContent=`Paso ${e} de ${d}`)}function E(e){return["informacion","archivo","resumen"][e-1]}function u(){const t=document.getElementById(E(c)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(n=>{n.value.trim()?m(n):(S(n),o=!1)}),o||L("Por favor, completa todos los campos requeridos antes de continuar."),o}function L(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function S(e){const t=e.checkValidity(),o=e.closest(".hci-field"),n=o==null?void 0:o.querySelector(".hci-field-error");if(t)m(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!n){const r=document.createElement("div");r.className="hci-field-error",r.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(r)}}function m(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function g(){var i,f,p,h,v,w,y;const e=((i=document.querySelector('input[name="nombre"]'))==null?void 0:i.value)||"",t=((h=(p=(f=document.querySelector('input[name="archivo"]'))==null?void 0:f.files)==null?void 0:p[0])==null?void 0:h.name)||"",o=((y=(w=(v=document.querySelector('select[name="magister_id"]'))==null?void 0:v.selectedOptions)==null?void 0:w[0])==null?void 0:y.text)||"",n=document.getElementById("summary-nombre"),r=document.getElementById("summary-archivo"),s=document.getElementById("summary-destinatario");n&&(n.textContent=e||"No especificado"),r&&(r.textContent=t||"Sin archivo seleccionado"),s&&(s.textContent=o||"Todos los programas")}window.submitForm=function(){u()&&document.querySelector(".hci-form").submit()};function B(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function q(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over")}function x(e){e.preventDefault(),e.currentTarget.classList.remove("drag-over");const t=e.dataTransfer.files;if(t.length>0){const o=document.getElementById("archivo-input");o.files=t,I({target:o})}}function I(e){const t=e.target.files[0];if(t){if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){alert("Por favor, selecciona un archivo PDF, DOC o DOCX."),e.target.value="";return}if(t.size>4*1024*1024){alert("El archivo no puede exceder los 4MB."),e.target.value="";return}document.getElementById("file-name").textContent=t.name,document.getElementById("file-preview").classList.remove("hidden"),document.getElementById("file-drop-text").textContent="Archivo seleccionado",g()}}function D(){document.getElementById("archivo-input").value="",document.getElementById("file-preview").classList.add("hidden"),document.getElementById("file-drop-text").textContent="Arrastra tu archivo aqu√≠",g()}window.handleDragOver=B;window.handleDragLeave=q;window.handleFileDrop=x;window.handleFileSelect=I;window.clearFile=D;
