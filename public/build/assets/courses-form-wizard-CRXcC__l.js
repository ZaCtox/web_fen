let s=1;const v=3;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".hci-form-section"),document.querySelectorAll(".hci-progress-step-vertical"),document.getElementById("progress-bar"),document.getElementById("progress-percentage"),document.getElementById("current-step"),m(1),p(1);const e=window.PERIODS||[],t={1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI"},o=document.getElementById("anio"),n=document.getElementById("numero"),r=document.getElementById("period_id");let u=null;function l(){const i=o.value;if(n.innerHTML='<option value="">-- Selecciona un trimestre --</option>',!i)return;e.filter(c=>c.anio==i).map(c=>({numero:c.numero,id:c.id})).sort((c,a)=>c.numero-a.numero).forEach(c=>{const a=document.createElement("option");a.value=c.numero,a.textContent=`Trimestre ${t[c.numero]||c.numero}`,n.appendChild(a)}),u&&(n.value=u,u=null),window.actualizarPeriodId()}if(window.actualizarPeriodId=function(){const i=o.value,d=n.value,c=e.find(a=>a.anio==i&&a.numero==d);r.value=c?c.id:"",console.log("Actualizando period_id:",{anio:i,numero:d,periodId:r.value,periodo:c})},o&&n&&r){o.addEventListener("change",()=>{l(),f()}),n.addEventListener("change",()=>{window.actualizarPeriodId(),f()});const i=r.value;if(i){const d=e.find(c=>c.id==i);d&&(o.value=d.anio,u=d.numero,l())}}document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(i=>{i.addEventListener("blur",function(){B(this)}),i.addEventListener("input",function(){y(this),f()})})});window.nextStep=function(){h()&&s<v&&(s++,m(s),p(s))};window.prevStep=function(){s>1&&(s--,m(s),p(s))};window.navigateToStep=function(e){(e<=s||h())&&(s=e,m(s),p(s))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/courses"):window.location.href=window.location.origin+"/courses"};function m(e){const t=document.querySelectorAll(".hci-form-section"),o=document.querySelectorAll(".hci-progress-step-vertical");t.forEach(r=>{r.classList.remove("active")});const n=document.getElementById(x(e));n&&(n.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"start"})),o.forEach((r,u)=>{u+1<=e?(r.classList.add("completed"),r.classList.add("active")):(r.classList.remove("completed"),r.classList.remove("active"))})}function p(e){const t=document.getElementById("progress-bar"),o=document.getElementById("progress-percentage"),n=document.getElementById("current-step"),r=e/v*100;t&&(t.style.height=r+"%"),o&&(o.textContent=Math.round(r)+"%"),n&&(n.textContent=`Paso ${e} de ${v}`)}function x(e){return["basica","programa","resumen"][e-1]}function h(){const t=document.getElementById(x(s)).querySelectorAll("input[required], select[required], textarea[required]");let o=!0;return t.forEach(n=>{n.value.trim()?y(n):(B(n),o=!1)}),o||L("Por favor, completa todos los campos requeridos antes de continuar."),o}function L(e){let t=document.getElementById("step-error-message");t||(t=document.createElement("div"),t.id="step-error-message",t.className="hci-error-message",document.querySelector(".hci-container").insertBefore(t,document.querySelector(".hci-wizard-layout"))),t.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">⚠️</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{t&&t.remove()},5e3)}function B(e){const t=e.checkValidity(),o=e.closest(".hci-field"),n=o==null?void 0:o.querySelector(".hci-field-error");if(t)y(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!n){const r=document.createElement("div");r.className="hci-field-error",r.textContent=e.validationMessage||"Este campo es requerido",o==null||o.appendChild(r)}}function y(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const t=e.closest(".hci-field"),o=t==null?void 0:t.querySelector(".hci-field-error");o&&o.remove()}function f(){var a,w,I,E,S,q,b;const e=((a=document.querySelector('input[name="nombre"]'))==null?void 0:a.value)||"";(w=document.querySelector('select[name="magister_id"]'))!=null&&w.value,(I=document.querySelector('select[name="anio"]'))!=null&&I.value,(E=document.querySelector('select[name="numero"]'))!=null&&E.value;const t=document.querySelector('select[name="magister_id"]'),o=document.querySelector('select[name="anio"]'),n=document.querySelector('select[name="numero"]'),r=((S=t==null?void 0:t.selectedOptions[0])==null?void 0:S.text)||"No seleccionado",u=((q=o==null?void 0:o.selectedOptions[0])==null?void 0:q.text)||"No seleccionado",l=((b=n==null?void 0:n.selectedOptions[0])==null?void 0:b.text)||"No seleccionado",g=document.getElementById("resumen-nombre"),i=document.getElementById("resumen-programa"),d=document.getElementById("resumen-anio"),c=document.getElementById("resumen-trimestre");g&&(g.textContent=e||"No especificado"),i&&(i.textContent=r),d&&(d.textContent=u),c&&(c.textContent=l)}window.submitForm=function(){if(h()){window.actualizarPeriodId();const e=new FormData(document.querySelector(".hci-form"));console.log("Datos del formulario antes de enviar:",{nombre:e.get("nombre"),magister_id:e.get("magister_id"),period_id:e.get("period_id"),anio:e.get("anio"),numero:e.get("numero")}),document.querySelector(".hci-form").submit()}};
