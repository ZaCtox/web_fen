let c=1;const a=4;document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hci-form-section .hci-field-error");if(e){const i=e.closest(".hci-form-section");i&&i.dataset.step&&(c=parseInt(i.dataset.step)||1)}v(c),y(c),document.querySelectorAll(".hci-input, .hci-select, .hci-textarea").forEach(i=>{i.addEventListener("blur",function(){M(this)}),i.addEventListener("input",function(){b(this),f()})});const t=document.querySelector('input[name="titulo"]'),r=document.querySelector('textarea[name="contenido"]'),n=document.querySelector('select[name="color"]');document.querySelectorAll('input[name="icono"]').forEach(i=>{i.addEventListener("change",function(){T(),g(),f()})}),t&&t.addEventListener("input",g),r&&r.addEventListener("input",g),n&&n.addEventListener("change",g),f(),T()});function T(){var t;const e=document.querySelectorAll('input[name="icono"]'),o=((t=document.querySelector('input[name="icono"]:checked'))==null?void 0:t.value)||"üì∞";e.forEach(r=>{const n=r.nextElementSibling;n&&(r.value===o?n.className="w-14 h-14 flex items-center justify-center text-3xl border-2 rounded-lg transition-all duration-200 hover:scale-110 border-[#4d82bc] bg-[#4d82bc]/10":n.className="w-14 h-14 flex items-center justify-center text-3xl border-2 rounded-lg transition-all duration-200 hover:scale-110 border-gray-300 hover:border-[#84b6f4]")})}window.nextStep=function(){h()&&c<a&&(c++,v(c),y(c))};window.prevStep=function(){c>1&&(c--,v(c),y(c))};window.navigateToStep=function(e){(e<=c||h())&&(c=e,v(c),y(c))};window.cancelForm=function(){window.hasUnsavedChanges&&window.hasUnsavedChanges()?window.showUnsavedChangesModal(window.location.origin+"/novedades"):window.location.href=window.location.origin+"/novedades"};function v(e){document.querySelectorAll(".hci-form-section").forEach(n=>{n.classList.remove("active")});const t=A(e),r=document.getElementById(t);r&&(r.classList.add("active"),r.scrollIntoView({behavior:"smooth",block:"start"})),window.updateWizardProgressSteps&&window.updateWizardProgressSteps(e),t==="resumen"&&f()}function y(e){const o=document.getElementById("progress-bar"),t=document.getElementById("progress-percentage"),r=document.getElementById("current-step"),n=e/a*100;o&&(o.style.height=n+"%"),t&&(t.textContent=Math.round(n)+"%"),r&&(r.textContent=`Paso ${e} de ${a}`);const s=document.getElementById("prev-btn"),i=document.getElementById("next-btn"),l=document.getElementById("submit-btn");s&&(s.style.display=e>1?"flex":"none"),i&&(i.style.display=e<a?"flex":"none"),l&&(l.style.display=e===a?"flex":"none")}function A(e){return["basica","configuracion","diseno","resumen"][e-1]}function h(){console.log(`üîç validateCurrentStep() - Paso ${c}`);const e=A(c);console.log(`üìã ID de secci√≥n: ${e}`);const o=document.getElementById(e);console.log("üìÑ Secci√≥n encontrada:",o);const t=o==null?void 0:o.querySelectorAll("input[required], select[required], textarea[required]");console.log("üìù Campos requeridos encontrados:",(t==null?void 0:t.length)||0);let r=!0;return t&&t.forEach((n,s)=>{console.log(`üîç Campo ${s+1}:`,n.name,"=",n.value),n.value.trim()?(console.log(`‚úÖ Campo ${n.name} tiene valor`),b(n)):(console.log(`‚ùå Campo ${n.name} est√° vac√≠o`),M(n),r=!1)}),console.log(`üéØ Paso ${c} es v√°lido:`,r),r||(console.log("‚ùå Mostrando error de validaci√≥n"),V("Por favor, completa todos los campos requeridos antes de continuar.")),r}function V(e){let o=document.getElementById("step-error-message");o||(o=document.createElement("div"),o.id="step-error-message",o.className="hci-error-message",document.querySelector(".hci-container").insertBefore(o,document.querySelector(".hci-wizard-layout"))),o.innerHTML=`
        <div class="hci-error-content">
            <span class="hci-error-icon">‚ö†Ô∏è</span>
            <span class="hci-error-text">${e}</span>
        </div>
    `,setTimeout(()=>{o&&o.remove()},5e3)}function M(e){const o=e.checkValidity(),t=e.closest(".hci-field"),r=t==null?void 0:t.querySelector(".hci-field-error");if(o)b(e);else if(e.classList.add("border-red-500"),e.classList.remove("border-gray-300"),!r){const n=document.createElement("div");n.className="hci-field-error",n.textContent=e.validationMessage||"Este campo es requerido",t==null||t.appendChild(n)}}function b(e){e.classList.remove("border-red-500"),e.classList.add("border-gray-300");const o=e.closest(".hci-field"),t=o==null?void 0:o.querySelector(".hci-field-error");t&&t.remove()}function f(){var q,C,B,L,P,N,$,k;const e=((q=document.querySelector('input[name="titulo"]'))==null?void 0:q.value)||"",o=((C=document.querySelector('textarea[name="contenido"]'))==null?void 0:C.value)||"",t=((B=document.querySelector('select[name="tipo_novedad"]'))==null?void 0:B.value)||"",r=((L=document.querySelector('input[name="es_urgente"]'))==null?void 0:L.checked)||!1,n=((P=document.querySelector('input[name="visible_publico"]'))==null?void 0:P.checked)||!1,s=document.querySelector('input[name="icono"]:checked'),i=(s==null?void 0:s.value)||"üì∞",l=((N=document.querySelector('select[name="color"]'))==null?void 0:N.value)||"blue",u=((k=($=document.querySelector('select[name="magister_id"]'))==null?void 0:$.selectedOptions[0])==null?void 0:k.text)||"No especificado",d=document.getElementById("resumen-titulo"),m=document.getElementById("resumen-contenido"),p=document.getElementById("resumen-tipo"),S=document.getElementById("resumen-urgente"),w=document.getElementById("resumen-visibilidad"),E=document.getElementById("resumen-icono"),x=document.getElementById("resumen-color"),I=document.getElementById("resumen-programa");d&&(d.textContent=e||"No especificado"),m&&(m.textContent=o||"No especificado"),p&&(p.textContent=t||"No especificado"),S&&(S.textContent=r?"S√≠":"No"),w&&(w.textContent=n?"P√∫blico":"Privado"),E&&(E.textContent=i),x&&(x.textContent=l),I&&(I.textContent=u)}function g(){var l,u,d;const e=((l=document.querySelector('input[name="titulo"]'))==null?void 0:l.value)||"T√≠tulo de la novedad";(u=document.querySelector('textarea[name="contenido"]'))!=null&&u.value;const o=((d=document.querySelector('select[name="color"]'))==null?void 0:d.value)||"blue",t=document.querySelector('input[name="icono"]:checked'),r=(t==null?void 0:t.value)||"üì∞",n=document.getElementById("preview-icon"),s=document.getElementById("preview-titulo"),i=document.getElementById("preview-color");if(n&&(n.textContent=r),s&&(s.textContent=e),i){const m={blue:"bg-blue-500",green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500",purple:"bg-purple-500",indigo:"bg-indigo-500"},p={blue:"Azul",green:"Verde",yellow:"Amarillo",red:"Rojo",purple:"Morado",indigo:"√çndigo"};i.className=`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${m[o]} text-white`,i.textContent=p[o]}}window.submitForm=function(){if(h()){if(!document.getElementById("form-loading-overlay")){const e=document.createElement("div");e.id="form-loading-overlay",e.className="loading-overlay",e.innerHTML=`
                <div class="loading-overlay-content">
                    <div class="inline-block w-12 h-12 animate-spin rounded-full border-4 border-solid border-[#4d82bc] border-r-transparent"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Procesando...</p>
                </div>
            `,document.body.appendChild(e)}document.querySelector(".hci-form").submit()}};
